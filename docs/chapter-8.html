<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Chapter 8 | Hydrological Drought (2nd Edition)</title>
  <meta name="description" content="Worked examples for Hydrologic Drought: Processes and Estimation Methods for Streamflow and Groundwater (2nd Edition)" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Chapter 8 | Hydrological Drought (2nd Edition)" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://github.com/jstagge/hydroDrought/docs" />
  
  <meta property="og:description" content="Worked examples for Hydrologic Drought: Processes and Estimation Methods for Streamflow and Groundwater (2nd Edition)" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Chapter 8 | Hydrological Drought (2nd Edition)" />
  
  <meta name="twitter:description" content="Worked examples for Hydrologic Drought: Processes and Estimation Methods for Streamflow and Groundwater (2nd Edition)" />
  

<meta name="author" content="Lena M. Tallaksen and Henny A.J. van Lanen" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="chapter-7.html"/>
<link rel="next" href="chapter-10.html"/>
<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="libs/pagedtable-1.1/js/pagedtable.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="chapter-5.html"><a href="chapter-5.html"><i class="fa fa-check"></i><b>1</b> Chapter 5</a>
<ul>
<li class="chapter" data-level="1.1" data-path="chapter-5.html"><a href="chapter-5.html#worked-example-5.1-flow-duration-curve"><i class="fa fa-check"></i><b>1.1</b> Worked Example 5.1: Flow Duration Curve</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="chapter-5.html"><a href="chapter-5.html#loading-the-data"><i class="fa fa-check"></i><b>1.1.1</b> Loading the Data</a></li>
<li class="chapter" data-level="1.1.2" data-path="chapter-5.html"><a href="chapter-5.html#calculation-of-the-fdc"><i class="fa fa-check"></i><b>1.1.2</b> Calculation of the FDC</a></li>
<li class="chapter" data-level="1.1.3" data-path="chapter-5.html"><a href="chapter-5.html#plot-of-the-fdc"><i class="fa fa-check"></i><b>1.1.3</b> Plot of the FDC</a></li>
<li class="chapter" data-level="1.1.4" data-path="chapter-5.html"><a href="chapter-5.html#selected-exceedance-values"><i class="fa fa-check"></i><b>1.1.4</b> Selected exceedance values</a></li>
<li class="chapter" data-level="1.1.5" data-path="chapter-5.html"><a href="chapter-5.html#fast-track"><i class="fa fa-check"></i><b>1.1.5</b> Fast-Track</a></li>
<li class="chapter" data-level="1.1.6" data-path="chapter-5.html"><a href="chapter-5.html#standardized-flow-duration-curves"><i class="fa fa-check"></i><b>1.1.6</b> Standardized Flow Duration Curves</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="chapter-5.html"><a href="chapter-5.html#worked-example-5.2-mean-annual-minimum-n-day-flow"><i class="fa fa-check"></i><b>1.2</b> Worked example 5.2: Mean annual minimum n-day flow</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="chapter-5.html"><a href="chapter-5.html#loading-the-data-1"><i class="fa fa-check"></i><b>1.2.1</b> Loading the Data</a></li>
<li class="chapter" data-level="1.2.2" data-path="chapter-5.html"><a href="chapter-5.html#calculation"><i class="fa fa-check"></i><b>1.2.2</b> Calculation</a></li>
<li class="chapter" data-level="1.2.3" data-path="chapter-5.html"><a href="chapter-5.html#fast-track-1"><i class="fa fa-check"></i><b>1.2.3</b> Fast Track</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="chapter-5.html"><a href="chapter-5.html#worked-example-5.3-base-flow-index"><i class="fa fa-check"></i><b>1.3</b> Worked Example 5.3: Base Flow Index</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="chapter-5.html"><a href="chapter-5.html#loading-the-data-2"><i class="fa fa-check"></i><b>1.3.1</b> Loading the Data</a></li>
<li class="chapter" data-level="1.3.2" data-path="chapter-5.html"><a href="chapter-5.html#calculation-1"><i class="fa fa-check"></i><b>1.3.2</b> Calculation</a></li>
<li class="chapter" data-level="1.3.3" data-path="chapter-5.html"><a href="chapter-5.html#results"><i class="fa fa-check"></i><b>1.3.3</b> Results</a></li>
<li class="chapter" data-level="1.3.4" data-path="chapter-5.html"><a href="chapter-5.html#fast-track-2"><i class="fa fa-check"></i><b>1.3.4</b> Fast Track</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="chapter-5.html"><a href="chapter-5.html#worked-example-5.4-threshold-level-method"><i class="fa fa-check"></i><b>1.4</b> Worked example 5.4: Threshold level method</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="chapter-5.html"><a href="chapter-5.html#loading-the-data-3"><i class="fa fa-check"></i><b>1.4.1</b> Loading the Data</a></li>
<li class="chapter" data-level="1.4.2" data-path="chapter-5.html"><a href="chapter-5.html#missing-values"><i class="fa fa-check"></i><b>1.4.2</b> Missing values</a></li>
<li class="chapter" data-level="1.4.3" data-path="chapter-5.html"><a href="chapter-5.html#threshold-selection-and-drought-events"><i class="fa fa-check"></i><b>1.4.3</b> Threshold selection and drought events</a></li>
<li class="chapter" data-level="1.4.4" data-path="chapter-5.html"><a href="chapter-5.html#removing-minor-droughts-filtering"><i class="fa fa-check"></i><b>1.4.4</b> Removing minor droughts (Filtering)</a></li>
<li class="chapter" data-level="1.4.5" data-path="chapter-5.html"><a href="chapter-5.html#eliminating-dependent-droughts-pooling"><i class="fa fa-check"></i><b>1.4.5</b> Eliminating dependent droughts (Pooling)</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="chapter-5.html"><a href="chapter-5.html#worked-example-5.5-sequent-peak-algorithm"><i class="fa fa-check"></i><b>1.5</b> Worked example 5.5: Sequent Peak Algorithm</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="chapter-5.html"><a href="chapter-5.html#loading-the-data-4"><i class="fa fa-check"></i><b>1.5.1</b> Loading the Data</a></li>
<li class="chapter" data-level="1.5.2" data-path="chapter-5.html"><a href="chapter-5.html#calculation-2"><i class="fa fa-check"></i><b>1.5.2</b> Calculation</a></li>
<li class="chapter" data-level="1.5.3" data-path="chapter-5.html"><a href="chapter-5.html#selection-of-the-drought-deficit-volume-and-duration"><i class="fa fa-check"></i><b>1.5.3</b> Selection of the drought deficit volume and duration</a></li>
<li class="chapter" data-level="1.5.4" data-path="chapter-5.html"><a href="chapter-5.html#results-1"><i class="fa fa-check"></i><b>1.5.4</b> Results</a></li>
<li class="chapter" data-level="1.5.5" data-path="chapter-5.html"><a href="chapter-5.html#fast-track-3"><i class="fa fa-check"></i><b>1.5.5</b> Fast Track</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="chapter-5.html"><a href="chapter-5.html#worked-example-5.6-example-of-how-to-estimate-sgi-using-data-from-stonor-park-uk"><i class="fa fa-check"></i><b>1.6</b> Worked example 5.6, Example of how to estimate SGI using data from Stonor Park, UK</a>
<ul>
<li class="chapter" data-level="1.6.1" data-path="chapter-5.html"><a href="chapter-5.html#load-the-data"><i class="fa fa-check"></i><b>1.6.1</b> Load the data</a></li>
<li class="chapter" data-level="1.6.2" data-path="chapter-5.html"><a href="chapter-5.html#create-a-regular-times-series-of-monthly-data"><i class="fa fa-check"></i><b>1.6.2</b> Create a regular times series of monthly data</a></li>
<li class="chapter" data-level="1.6.3" data-path="chapter-5.html"><a href="chapter-5.html#calculate-an-sgi-values"><i class="fa fa-check"></i><b>1.6.3</b> Calculate an SGI values</a></li>
<li class="chapter" data-level="1.6.4" data-path="chapter-5.html"><a href="chapter-5.html#fast-track-4"><i class="fa fa-check"></i><b>1.6.4</b> Fast-Track</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="chapter-5.html"><a href="chapter-5.html#worked-example-5.7-rank-and-correlation-coefficients"><i class="fa fa-check"></i><b>1.7</b> Worked example 5.7: Rank and correlation coefficients</a>
<ul>
<li class="chapter" data-level="1.7.1" data-path="chapter-5.html"><a href="chapter-5.html#loading-the-data-5"><i class="fa fa-check"></i><b>1.7.1</b> Loading the Data</a></li>
<li class="chapter" data-level="1.7.2" data-path="chapter-5.html"><a href="chapter-5.html#indices"><i class="fa fa-check"></i><b>1.7.2</b> Indices</a></li>
<li class="chapter" data-level="1.7.3" data-path="chapter-5.html"><a href="chapter-5.html#ranks"><i class="fa fa-check"></i><b>1.7.3</b> Ranks</a></li>
<li class="chapter" data-level="1.7.4" data-path="chapter-5.html"><a href="chapter-5.html#pearson-correlation"><i class="fa fa-check"></i><b>1.7.4</b> Pearson correlation</a></li>
<li class="chapter" data-level="1.7.5" data-path="chapter-5.html"><a href="chapter-5.html#spearman-rank-correlation"><i class="fa fa-check"></i><b>1.7.5</b> Spearman (rank) correlation</a></li>
</ul></li>
<li class="chapter" data-level="1.8" data-path="chapter-5.html"><a href="chapter-5.html#worked-example-5.8-no-flow-indices"><i class="fa fa-check"></i><b>1.8</b> Worked example 5.8: No-flow indices</a>
<ul>
<li class="chapter" data-level="1.8.1" data-path="chapter-5.html"><a href="chapter-5.html#loading-the-data-6"><i class="fa fa-check"></i><b>1.8.1</b> Loading the Data</a></li>
<li class="chapter" data-level="1.8.2" data-path="chapter-5.html"><a href="chapter-5.html#finding-intermittent-rivers"><i class="fa fa-check"></i><b>1.8.2</b> Finding intermittent rivers</a></li>
<li class="chapter" data-level="1.8.3" data-path="chapter-5.html"><a href="chapter-5.html#computing-metrics"><i class="fa fa-check"></i><b>1.8.3</b> Computing metrics</a></li>
<li class="chapter" data-level="1.8.4" data-path="chapter-5.html"><a href="chapter-5.html#visualising-streamflow-permanence-spells"><i class="fa fa-check"></i><b>1.8.4</b> Visualising streamflow permanence (spells)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="chapter-6.html"><a href="chapter-6.html"><i class="fa fa-check"></i><b>2</b> Chapter 6</a>
<ul>
<li class="chapter" data-level="2.1" data-path="chapter-6.html"><a href="chapter-6.html#worked-example-6.1-low-flow-frequency-analysis"><i class="fa fa-check"></i><b>2.1</b> Worked Example 6.1: Low flow frequency analysis</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="chapter-6.html"><a href="chapter-6.html#loading-the-data-7"><i class="fa fa-check"></i><b>2.1.1</b> Loading the Data</a></li>
<li class="chapter" data-level="2.1.2" data-path="chapter-6.html"><a href="chapter-6.html#derivation-of-an-empirical-distribution-function"><i class="fa fa-check"></i><b>2.1.2</b> Derivation of an empirical distribution function</a></li>
<li class="chapter" data-level="2.1.3" data-path="chapter-6.html"><a href="chapter-6.html#fitting-a-distribution"><i class="fa fa-check"></i><b>2.1.3</b> Fitting a distribution</a></li>
<li class="chapter" data-level="2.1.4" data-path="chapter-6.html"><a href="chapter-6.html#estimation-of-t-year-events"><i class="fa fa-check"></i><b>2.1.4</b> Estimation of T-year events</a></li>
<li class="chapter" data-level="2.1.5" data-path="chapter-6.html"><a href="chapter-6.html#ft"><i class="fa fa-check"></i><b>2.1.5</b> Fast Track</a></li>
<li class="chapter" data-level="2.1.6" data-path="chapter-6.html"><a href="chapter-6.html#probability-plot-using-the-exponential-reduced-variate"><i class="fa fa-check"></i><b>2.1.6</b> Probability plot using the exponential reduced variate</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="chapter-6.html"><a href="chapter-6.html#worked-example-6.2-drought-deficit-frequency-analysis"><i class="fa fa-check"></i><b>2.2</b> Worked Example 6.2: Drought deficit frequency analysis</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="chapter-6.html"><a href="chapter-6.html#data"><i class="fa fa-check"></i><b>2.2.1</b> Data</a></li>
<li class="chapter" data-level="2.2.2" data-path="chapter-6.html"><a href="chapter-6.html#derivation-of-distribution-function"><i class="fa fa-check"></i><b>2.2.2</b> Derivation of distribution function</a></li>
<li class="chapter" data-level="2.2.3" data-path="chapter-6.html"><a href="chapter-6.html#calculation-of-the-t-year-event"><i class="fa fa-check"></i><b>2.2.3</b> Calculation of the T-year event</a></li>
<li class="chapter" data-level="2.2.4" data-path="chapter-6.html"><a href="chapter-6.html#manual-computation"><i class="fa fa-check"></i><b>2.2.4</b> Manual computation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="chapter-7.html"><a href="chapter-7.html"><i class="fa fa-check"></i><b>3</b> Chapter 7</a>
<ul>
<li class="chapter" data-level="3.1" data-path="chapter-7.html"><a href="chapter-7.html#worked-example-7.1-linear-trend-analysis"><i class="fa fa-check"></i><b>3.1</b> Worked example 7.1: Linear trend analysis</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="chapter-7.html"><a href="chapter-7.html#loading-the-data-8"><i class="fa fa-check"></i><b>3.1.1</b> Loading the Data</a></li>
<li class="chapter" data-level="3.1.2" data-path="chapter-7.html"><a href="chapter-7.html#linear-trend-for-elbe-river"><i class="fa fa-check"></i><b>3.1.2</b> Linear trend for Elbe River</a></li>
<li class="chapter" data-level="3.1.3" data-path="chapter-7.html"><a href="chapter-7.html#linear-trend-for-göta-river"><i class="fa fa-check"></i><b>3.1.3</b> Linear trend for Göta River</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="chapter-7.html"><a href="chapter-7.html#worked-example-7.2-non-parametric-trends"><i class="fa fa-check"></i><b>3.2</b> Worked Example 7.2: Non Parametric Trends</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="chapter-7.html"><a href="chapter-7.html#loading-the-data-9"><i class="fa fa-check"></i><b>3.2.1</b> Loading the Data</a></li>
<li class="chapter" data-level="3.2.2" data-path="chapter-7.html"><a href="chapter-7.html#mann-kendall-test"><i class="fa fa-check"></i><b>3.2.2</b> Mann-Kendall test</a></li>
<li class="chapter" data-level="3.2.3" data-path="chapter-7.html"><a href="chapter-7.html#high-leverage-outlier-effects"><i class="fa fa-check"></i><b>3.2.3</b> High leverage outlier effects</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="chapter-7.html"><a href="chapter-7.html#worked-example-7.3-structural-change-analysis"><i class="fa fa-check"></i><b>3.3</b> Worked Example 7.3: Structural Change Analysis</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="chapter-7.html"><a href="chapter-7.html#visualizing-daily-flow"><i class="fa fa-check"></i><b>3.3.1</b> Visualizing Daily Flow</a></li>
<li class="chapter" data-level="3.3.2" data-path="chapter-7.html"><a href="chapter-7.html#testing-for-a-change-point"><i class="fa fa-check"></i><b>3.3.2</b> Testing for a change point</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="chapter-7.html"><a href="chapter-7.html#worked-example-7.4-principal-component-analysis"><i class="fa fa-check"></i><b>3.4</b> Worked Example 7.4: Principal Component Analysis</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="chapter-7.html"><a href="chapter-7.html#simple-pca-with-two-variables"><i class="fa fa-check"></i><b>3.4.1</b> Simple PCA with two variables</a></li>
<li class="chapter" data-level="3.4.2" data-path="chapter-7.html"><a href="chapter-7.html#pca-with-all-variables"><i class="fa fa-check"></i><b>3.4.2</b> PCA with all variables</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="chapter-8.html"><a href="chapter-8.html"><i class="fa fa-check"></i><b>4</b> Chapter 8</a>
<ul>
<li class="chapter" data-level="4.1" data-path="chapter-8.html"><a href="chapter-8.html#worked-example-8.1-regional-regression"><i class="fa fa-check"></i><b>4.1</b> Worked example 8.1: Regional regression</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="chapter-8.html"><a href="chapter-8.html#introduction"><i class="fa fa-check"></i><b>4.1.1</b> Introduction</a></li>
<li class="chapter" data-level="4.1.2" data-path="chapter-8.html"><a href="chapter-8.html#data-import"><i class="fa fa-check"></i><b>4.1.2</b> Data import</a></li>
<li class="chapter" data-level="4.1.3" data-path="chapter-8.html"><a href="chapter-8.html#simple-linear-regression"><i class="fa fa-check"></i><b>4.1.3</b> Simple linear regression</a></li>
<li class="chapter" data-level="4.1.4" data-path="chapter-8.html"><a href="chapter-8.html#stepwise-regression"><i class="fa fa-check"></i><b>4.1.4</b> Stepwise regression</a></li>
<li class="chapter" data-level="4.1.5" data-path="chapter-8.html"><a href="chapter-8.html#remove-outliers-based-on-cooks-distance"><i class="fa fa-check"></i><b>4.1.5</b> Remove outliers based on Cook’s distance</a></li>
<li class="chapter" data-level="4.1.6" data-path="chapter-8.html"><a href="chapter-8.html#robust-regression-alternative-to-manual-outlier-detection"><i class="fa fa-check"></i><b>4.1.6</b> Robust regression (alternative to manual outlier detection)</a></li>
<li class="chapter" data-level="4.1.7" data-path="chapter-8.html"><a href="chapter-8.html#references"><i class="fa fa-check"></i><b>4.1.7</b> References</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="chapter-8.html"><a href="chapter-8.html#worked-example-8.2-top-kriging"><i class="fa fa-check"></i><b>4.2</b> Worked example 8.2: Top-kriging</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="chapter-8.html"><a href="chapter-8.html#introduction-1"><i class="fa fa-check"></i><b>4.2.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2.2" data-path="chapter-8.html"><a href="chapter-8.html#data-import-1"><i class="fa fa-check"></i><b>4.2.2</b> Data import</a></li>
<li class="chapter" data-level="4.2.3" data-path="chapter-8.html"><a href="chapter-8.html#explorative-statistics"><i class="fa fa-check"></i><b>4.2.3</b> Explorative statistics</a></li>
<li class="chapter" data-level="4.2.4" data-path="chapter-8.html"><a href="chapter-8.html#variogram-analysis"><i class="fa fa-check"></i><b>4.2.4</b> Variogram analysis</a></li>
<li class="chapter" data-level="4.2.5" data-path="chapter-8.html"><a href="chapter-8.html#kriging"><i class="fa fa-check"></i><b>4.2.5</b> Kriging</a></li>
<li class="chapter" data-level="4.2.6" data-path="chapter-8.html"><a href="chapter-8.html#cross-validation"><i class="fa fa-check"></i><b>4.2.6</b> Cross-validation</a></li>
<li class="chapter" data-level="4.2.7" data-path="chapter-8.html"><a href="chapter-8.html#references-1"><i class="fa fa-check"></i><b>4.2.7</b> References</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="chapter-10.html"><a href="chapter-10.html"><i class="fa fa-check"></i><b>5</b> Chapter 10</a>
<ul>
<li class="chapter" data-level="5.1" data-path="chapter-10.html"><a href="chapter-10.html#worked-example-10.1-quantifying-the-human-influence-on-drought"><i class="fa fa-check"></i><b>5.1</b> Worked example 10.1: Quantifying the human influence on drought</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="chapter-10.html"><a href="chapter-10.html#loading-the-data-10"><i class="fa fa-check"></i><b>5.1.1</b> Loading the data</a></li>
<li class="chapter" data-level="5.1.2" data-path="chapter-10.html"><a href="chapter-10.html#threshold-calculation"><i class="fa fa-check"></i><b>5.1.2</b> Threshold calculation</a></li>
<li class="chapter" data-level="5.1.3" data-path="chapter-10.html"><a href="chapter-10.html#calculate-the-benchmark-drought-characteristics-drought-duration-and-deficit-volume"><i class="fa fa-check"></i><b>5.1.3</b> Calculate the benchmark drought characteristics (drought duration and deficit volume)</a></li>
<li class="chapter" data-level="5.1.4" data-path="chapter-10.html"><a href="chapter-10.html#calculate-the-human-influenced-drought-characteristics"><i class="fa fa-check"></i><b>5.1.4</b> Calculate the human-influenced drought characteristics</a></li>
<li class="chapter" data-level="5.1.5" data-path="chapter-10.html"><a href="chapter-10.html#comparison-of-drought-characteristics"><i class="fa fa-check"></i><b>5.1.5</b> Comparison of drought characteristics</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="chapter-12.html"><a href="chapter-12.html"><i class="fa fa-check"></i><b>6</b> Chapter 12</a>
<ul>
<li class="chapter" data-level="6.1" data-path="chapter-12.html"><a href="chapter-12.html#worked-example-12.1-classifying-an-impact-report-by-the-edii-impact-category-and-type-scheme"><i class="fa fa-check"></i><b>6.1</b> Worked example 12.1: Classifying an impact report by the EDII impact category and type scheme</a></li>
<li class="chapter" data-level="6.2" data-path="chapter-12.html"><a href="chapter-12.html#worked-example-12.2-drought-impact-model"><i class="fa fa-check"></i><b>6.2</b> Worked example 12.2: Drought Impact Model</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="chapter-12.html"><a href="chapter-12.html#loading-the-data-11"><i class="fa fa-check"></i><b>6.2.1</b> Loading the data</a></li>
<li class="chapter" data-level="6.2.2" data-path="chapter-12.html"><a href="chapter-12.html#preliminary-visual-comparison"><i class="fa fa-check"></i><b>6.2.2</b> Preliminary visual comparison</a></li>
<li class="chapter" data-level="6.2.3" data-path="chapter-12.html"><a href="chapter-12.html#logistic-regression"><i class="fa fa-check"></i><b>6.2.3</b> Logistic Regression</a></li>
<li class="chapter" data-level="6.2.4" data-path="chapter-12.html"><a href="chapter-12.html#predicting-drought-impacts"><i class="fa fa-check"></i><b>6.2.4</b> Predicting drought impacts</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="chapter-13.html"><a href="chapter-13.html"><i class="fa fa-check"></i><b>7</b> Chapter 13</a>
<ul>
<li class="chapter" data-level="7.1" data-path="chapter-13.html"><a href="chapter-13.html#worked-example-13.1-forecast-skill"><i class="fa fa-check"></i><b>7.1</b> Worked example 13.1: Forecast skill</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="chapter-13.html"><a href="chapter-13.html#loading-the-data-12"><i class="fa fa-check"></i><b>7.1.1</b> Loading the Data</a></li>
<li class="chapter" data-level="7.1.2" data-path="chapter-13.html"><a href="chapter-13.html#calculate-long-term-low-flow-threshold-from-observations"><i class="fa fa-check"></i><b>7.1.2</b> Calculate long-term low flow threshold from observations</a></li>
<li class="chapter" data-level="7.1.3" data-path="chapter-13.html"><a href="chapter-13.html#calculate-the-brier-score-bs"><i class="fa fa-check"></i><b>7.1.3</b> Calculate the Brier Score (BS)</a></li>
<li class="chapter" data-level="7.1.4" data-path="chapter-13.html"><a href="chapter-13.html#calculate-the-brier-skill-score-bss"><i class="fa fa-check"></i><b>7.1.4</b> Calculate the Brier Skill Score (BSS)</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Hydrological Drought (2nd Edition)</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="chapter-8" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Chapter 8</h1>
<div id="worked-example-8.1-regional-regression" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Worked example 8.1: Regional regression</h2>
<div id="introduction" class="section level3" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> Introduction</h3>
<p>This vignette demonstrates the application of regional regression analysis to model low flows in a spatial context. We use the regional dataset of 30 catchments situated in the forelands and pre-Alps in the north-east of Austria (Section 4.5.2). The dataset is fully described in Laaha &amp; Blöschl (2006a, 2006b). The target variable is the long-term low flow characteristic <span class="math inline">\(q_{95}\)</span>, i.e. <span class="math inline">\(Q_{95}\)</span> standardized by catchment area to eliminate its predominant effect on low flows. For nested catchments, the <span class="math inline">\(q_{95}\)</span> was disaggregated into the residual <span class="math inline">\(q_{95}\)</span> of sub-catchments to decrease statistical dependency of observations. The method assumes synchronicity of low flow events of neighboring gauges at the same river. For more details on this particular river network approach see Section 8.7.2.</p>
<p>In this section we learn how to</p>
<ul>
<li>fit a multiple linear regression model,</li>
<li>perform stepwise regression to perform variable selection and deal with collinearity,</li>
<li>employ the Cook’s distance method to deal with outliers,</li>
<li>use the MM-type robust regression method, and</li>
<li>create specific plots to analyse the quality of the regression model and the specific contribution of each predictor to the regression estimate.</li>
</ul>
</div>
<div id="data-import" class="section level3" number="4.1.2">
<h3><span class="header-section-number">4.1.2</span> Data import</h3>
<p>The text file named <code>Austria_30.txt</code> contains several catchment characteristics for the 30 catchments of the regional data set. Each observation (each line) in the text file corresponds to a single gauging station located at the catchment outlet. The variables (our catchment descriptors) are represented as columns of this data set.</p>
<p>Let us import this tabular data set into an object <code>x0</code>. As the very first line of the text file contains the column headers, we have to specify the <code>header</code> argument accordingly. The function <code>read.table()</code> will return a <code>data.frame</code>.</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="chapter-8.html#cb176-1" aria-hidden="true" tabindex="-1"></a>x0 <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;../../data/Austria_30.txt&quot;</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>To get a glimpse of the imported data set, let us print the first three lines of the object <code>x0</code>. They contain the catchment descriptors of the first three catchments.</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="chapter-8.html#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(x0, <span class="at">n =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>##    DBMSNR  HZBNR   X_LB   Y_LB q95s q95w  q95     A  H0  Hx  Hr    Hm  Sm  Ssl  Smo Sst     P    Ps
## 1 1001003 210039 632579 399019 1.11 1.76 1.21 117.5 336 850 514 588.5 8.3 60.5 39.5   0 737.1 487.4
## 2 1001005 210054 641191 397501 1.09 1.55 1.23 107.6 237 705 468 360.4 4.8 91.5  8.6   0 669.0 440.5
## 3 1001006 210062 639309 404781 0.92 1.25 0.98 149.6 256 781 525 470.1 7.4 64.6 35.4   0 701.2 456.8
##      Pw Gb   Gq   Gt Gf Gl   Gc Ggs  Ggd Gso  Lu   La Lc  Lg   Lf Lr Lwa   D
## 1 249.6  0  5.8 20.4  0  0 65.9   0  7.9   0 0.5 43.9  0 8.4 47.2  0   0 881
## 2 228.4  0  7.8 58.5  0  0 14.9   0 18.9   0 3.4 38.2  0 2.4 56.1  0   0 720
## 3 244.3  0 10.7 33.6  0  0 47.2   0  8.5   0 4.3 38.3  0 9.3 48.1  0   0 839</code></pre>
<p>To make sure all variables are imported either as class <code>integer</code> or <code>numeric</code> (and not accidentally as class <code>character</code> or <code>factor</code>) let us have a look at the structure of the object <code>x0</code>. Calling the function <code>str()</code> will print the dimensions of the <code>data.frame</code> in the very first line. The following lines contain the name of each variable, its class, and the first few values.</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="chapter-8.html#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(x0)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    30 obs. of  36 variables:
##  $ DBMSNR: int  1001003 1001005 1001006 1001008 1001019 1001021 1001022 1001023 1001026 1001027 ...
##  $ HZBNR : int  210039 210054 210062 210088 210211 210237 210245 210252 210286 210294 ...
##  $ X_LB  : int  632579 641191 639309 637884 613036 631684 623122 630727 627048 634613 ...
##  $ Y_LB  : int  399019 397501 404781 437789 350694 371673 383547 374437 355737 352828 ...
##  $ q95s  : num  1.11 1.09 0.92 0.67 2.33 1.26 1.63 0.72 0.57 0.46 ...
##  $ q95w  : num  1.76 1.55 1.25 0.91 2.88 2 2.19 1.21 0.91 0.71 ...
##  $ q95   : num  1.21 1.23 0.98 0.71 2.76 1.44 1.83 1.06 0.65 0.63 ...
##  $ A     : num  118 108 150 223 139 ...
##  $ H0    : int  336 237 256 175 237 241 328 264 220 201 ...
##  $ Hx    : int  850 705 781 720 452 776 834 827 446 334 ...
##  $ Hr    : int  514 468 525 545 215 535 506 563 226 133 ...
##  $ Hm    : num  588 360 470 321 310 ...
##  $ Sm    : num  8.3 4.8 7.4 5.9 3.9 5 10.4 5.6 4.6 3.8 ...
##  $ Ssl   : num  60.5 91.5 64.6 75.9 92.3 86.4 40.4 80.9 92.6 94.1 ...
##  $ Smo   : num  39.5 8.6 35.4 24.1 7.7 13.6 59.6 19.1 7.4 5.9 ...
##  $ Sst   : num  0 0 0 0 0 0 0 0 0 0 ...
##  $ P     : num  737 669 701 630 683 ...
##  $ Ps    : num  487 440 457 403 458 ...
##  $ Pw    : num  250 228 244 227 225 ...
##  $ Gb    : num  0 0 0 0 0 0 0 0 0 0 ...
##  $ Gq    : num  5.8 7.8 10.7 20.5 5.7 7.2 14.2 0.1 10.7 5.6 ...
##  $ Gt    : num  20.4 58.5 33.6 63.1 46.3 55.2 15.4 42 71.2 75.8 ...
##  $ Gf    : num  0 0 0 0 0 1.8 31.5 16.4 0 0.1 ...
##  $ Gl    : num  0 0 0 1.2 0 2.9 17.3 15.5 0.1 0 ...
##  $ Gc    : num  65.9 14.9 47.2 13.4 0 8 21.3 0 1.3 0.4 ...
##  $ Ggs   : num  0 0 0 1.5 48 14.4 0.3 26 16.8 18.2 ...
##  $ Ggd   : num  7.9 18.9 8.5 0.2 0 10.6 0 0 0 0 ...
##  $ Gso   : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ Lu    : num  0.5 3.4 4.3 7.8 0 0.7 0.3 0.5 0.2 0.4 ...
##  $ La    : num  43.9 38.2 38.3 56.4 58.8 54 34.7 54.9 52.2 35.4 ...
##  $ Lc    : num  0 0 0 1.8 0 0 0 0 0 0 ...
##  $ Lg    : num  8.4 2.4 9.3 2.6 0.4 5.9 1.7 0 0.5 0 ...
##  $ Lf    : num  47.2 56.1 48.1 31.2 40.8 39.4 63.3 44.6 46.9 64.1 ...
##  $ Lr    : num  0 0 0 0.2 0 0 0 0 0 0 ...
##  $ Lwa   : num  0 0 0 0 0 0 0 0 0.3 0.1 ...
##  $ D     : int  881 720 839 627 915 858 952 900 753 815 ...</code></pre>
<p>Another way to find out the dimensions of an object is to call <code>dim(x0)</code>, <code>ncol(x0)</code> or <code>nrow(x0)</code> explicitly.</p>
<p>The raw data set <code>x0</code> contains some variables which we do not want to use in our regression model, e.g. the id number or the coordinates of the gauging station. We will remove the columns to simplify the subsequent analysis. It is also a good idea to assign meaningful row names to the <code>data.frame</code> (e.g. the station’s id <code>'HZBNR'</code> or its location name ) to be able to identify the observations later on.</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="chapter-8.html#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(x0) <span class="ot">&lt;-</span> x0<span class="sc">$</span>HZBNR</span>
<span id="cb181-2"><a href="chapter-8.html#cb181-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-3"><a href="chapter-8.html#cb181-3" aria-hidden="true" tabindex="-1"></a>remove <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;DBMSNR&quot;</span>, <span class="st">&quot;HZBNR&quot;</span>, <span class="st">&quot;X_LB&quot;</span>, <span class="st">&quot;Y_LB&quot;</span>, <span class="st">&quot;q95s&quot;</span>, <span class="st">&quot;q95w&quot;</span>, <span class="st">&quot;A&quot;</span>)</span>
<span id="cb181-4"><a href="chapter-8.html#cb181-4" aria-hidden="true" tabindex="-1"></a>keep <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">colnames</span>(x0), remove)</span>
<span id="cb181-5"><a href="chapter-8.html#cb181-5" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> x0[, keep]</span>
<span id="cb181-6"><a href="chapter-8.html#cb181-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(x)</span></code></pre></div>
<pre><code>##         q95  H0  Hx  Hr      Hm  Sm  Ssl  Smo Sst       P      Ps      Pw Gb   Gq   Gt  Gf  Gl   Gc
## 210039 1.21 336 850 514 588.500 8.3 60.5 39.5   0 737.100 487.400 249.600  0  5.8 20.4 0.0 0.0 65.9
## 210054 1.23 237 705 468 360.400 4.8 91.5  8.6   0 669.000 440.500 228.400  0  7.8 58.5 0.0 0.0 14.9
## 210062 0.98 256 781 525 470.100 7.4 64.6 35.4   0 701.200 456.800 244.300  0 10.7 33.6 0.0 0.0 47.2
## 210088 0.71 175 720 545 321.219 5.9 75.9 24.1   0 630.441 403.484 226.722  0 20.5 63.1 0.0 1.2 13.4
## 210211 2.76 237 452 215 310.100 3.9 92.3  7.7   0 683.000 457.900 225.200  0  5.7 46.3 0.0 0.0  0.0
## 210237 1.44 241 776 535 378.307 5.0 86.4 13.6   0 680.122 459.959 220.211  0  7.2 55.2 1.8 2.9  8.0
##         Ggs  Ggd Gso  Lu   La  Lc  Lg   Lf  Lr Lwa   D
## 210039  0.0  7.9   0 0.5 43.9 0.0 8.4 47.2 0.0   0 881
## 210054  0.0 18.9   0 3.4 38.2 0.0 2.4 56.1 0.0   0 720
## 210062  0.0  8.5   0 4.3 38.3 0.0 9.3 48.1 0.0   0 839
## 210088  1.5  0.2   0 7.8 56.4 1.8 2.6 31.2 0.2   0 627
## 210211 48.0  0.0   0 0.0 58.8 0.0 0.4 40.8 0.0   0 915
## 210237 14.4 10.6   0 0.7 54.0 0.0 5.9 39.4 0.0   0 858</code></pre>
</div>
<div id="simple-linear-regression" class="section level3" number="4.1.3">
<h3><span class="header-section-number">4.1.3</span> Simple linear regression</h3>
<p>As a starting point of the analysis, we fit a simple linear regression model. We take the mean annual precipitation <span class="math inline">\(P\)</span> as the predictor, since it is likely an important control of low flows in the study area.</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="chapter-8.html#cb183-1" aria-hidden="true" tabindex="-1"></a>lm.simple <span class="ot">&lt;-</span> <span class="fu">lm</span>(q95 <span class="sc">~</span> P, <span class="at">data =</span> x)</span>
<span id="cb183-2"><a href="chapter-8.html#cb183-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-3"><a href="chapter-8.html#cb183-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm.simple)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = q95 ~ P, data = x)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -1.5445 -0.5422 -0.2251  0.0541  3.0542 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)   
## (Intercept) -2.063146   1.130868  -1.824  0.07878 . 
## P            0.005289   0.001727   3.062  0.00482 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.96 on 28 degrees of freedom
## Multiple R-squared:  0.2508, Adjusted R-squared:  0.2241 
## F-statistic: 9.375 on 1 and 28 DF,  p-value: 0.004817</code></pre>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="chapter-8.html#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb185-2"><a href="chapter-8.html#cb185-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lm.simple)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-151-1.png" width="672" /></p>
<!-- Explore the fitted model object -->
<!-- ```{r} -->
<!-- str(lm.simple) -->
<!-- ``` -->
<!-- Note that the object is a list, containing vectors, data frames, etc. as elements.  -->
<!-- These elements may be extracted for further analysis via, e.g.`lm.simple$residuals` -->
<!-- ```{r} -->
<!-- lm.simple$residuals -->
<!-- ``` -->
<p>The regression summary contains the residual statistics, the coefficients table, and performance statistics such as the residual standard error (equivalent to the <span class="math inline">\(RMSE\)</span>) and the multiple R-squared (equivalent to the coefficient of determination <span class="math inline">\(R^2\)</span>). We see from the t-test that <span class="math inline">\(P\)</span> is a highly significant predictor (<span class="math inline">\(p-value\)</span> =<code>0.00482</code>) but the intercept is not significant at the <span class="math inline">\(\alpha\)</span> =<code>0.05</code> level. We further learn that the model explains <code>25.08 %</code> of the low flow variability in the study area, which is quite high for a single predictor model. The estimated regression coefficient of <span class="math inline">\(P\)</span> (when multiplied by 100) translates to a <span class="math inline">\(q_{95}\)</span> increase of <code>0.53</code> <span class="math inline">\(l s^{-1} km^{-2}\)</span> per 100 mm increase in precipitation index.</p>
<p>The residual plots can be used to verify the assumptions of the model. In our example, the residuals are quite normally distributed but extreme outliers seem to violate this assumption. A procedure how to deal with such outliers is discussed later in the worked example. The diagnosis gives no clear evidence about the homoscedasticity, due to the presence of outliers in combination with a small data set.</p>
</div>
<div id="stepwise-regression" class="section level3" number="4.1.4">
<h3><span class="header-section-number">4.1.4</span> Stepwise regression</h3>
<p>In stepwise regression an ‘optimal’ model (based on some information criterion, such as the <span class="math inline">\(AIC\)</span>, <span class="math inline">\(BIC\)</span> or <span class="math inline">\(C_p\)</span>) is obtained by iteratively adding and removing variables. Our procedure will be based on the <span class="math inline">\(AIC\)</span>, following the standard setting in <span class="math inline">\(R\)</span>. The elementary steps of adding and dropping variables are demonstrated below.</p>
<div id="manual-forward-selection" class="section level4" number="4.1.4.1">
<h4><span class="header-section-number">4.1.4.1</span> Manual forward selection</h4>
<p>The first approach to stepwise regression is to start from the empty model and adding the variable with highest explicative value. Such a <em>manual forward selection</em> can be performed by calling <code>add1()</code>. The function takes a fitted model object together with a <code>scope</code> formula which specifies the variables to be considered for adding. In our case the scope contains all variables. Instead of using an empty model our initial model already contains the mean annual precipitation <span class="math inline">\(P\)</span>, as we can savely assume that the <span class="math inline">\(q_{95}\)</span> low flow will depend on the long-term average precipitation of the catchment.</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="chapter-8.html#cb186-1" aria-hidden="true" tabindex="-1"></a>model.init <span class="ot">&lt;-</span> <span class="fu">lm</span>(q95 <span class="sc">~</span> P, <span class="at">data =</span> x)</span>
<span id="cb186-2"><a href="chapter-8.html#cb186-2" aria-hidden="true" tabindex="-1"></a>scope <span class="ot">&lt;-</span> <span class="fu">formula</span>(<span class="fu">paste</span>(<span class="st">&quot;~&quot;</span>, <span class="fu">paste</span>(<span class="fu">colnames</span>(x)[<span class="sc">-</span><span class="dv">1</span>], <span class="at">collapse =</span> <span class="st">&quot; + &quot;</span>)))</span>
<span id="cb186-3"><a href="chapter-8.html#cb186-3" aria-hidden="true" tabindex="-1"></a><span class="fu">add1</span>(model.init, <span class="at">scope =</span> scope)</span></code></pre></div>
<pre><code>## Single term additions
## 
## Model:
## q95 ~ P
##        Df Sum of Sq    RSS     AIC
## &lt;none&gt;              25.804 -0.5204
## H0      1    0.0723 25.731  1.3954
## Hx      1    2.5418 23.262 -1.6315
## Hr      1    2.2560 23.548 -1.2651
## Hm      1    1.6324 24.171 -0.4810
## Sm      1    0.7097 25.094  0.6429
## Ssl     1    0.1427 25.661  1.3132
## Smo     1    0.1105 25.693  1.3509
## Sst     1    3.0734 22.730 -2.3251
## Ps      1    2.0601 23.744 -1.0166
## Pw      1    2.0292 23.774 -0.9775
## Gb      1    0.8388 24.965  0.4882
## Gq      1    3.4904 22.313 -2.8804
## Gt      1    1.8171 23.987 -0.7111
## Gf      1    0.0693 25.734  1.3989
## Gl      1    0.1086 25.695  1.3530
## Gc      1    0.3474 25.456  1.0729
## Ggs     1    2.9767 22.827 -2.1977
## Ggd     1    0.3058 25.498  1.1219
## Gso     1    0.0048 25.799  1.4740
## Lu      1    1.2721 24.532 -0.0371
## La      1    0.1356 25.668  1.3215
## Lc      1    0.1649 25.639  1.2873
## Lg      1    1.9892 23.814 -0.9272
## Lf      1    0.0083 25.795  1.4700
## Lr      1    0.3691 25.434  1.0473
## Lwa     1    6.4173 19.386 -7.0989
## D       1    2.5644 23.239 -1.6606</code></pre>
<p>This table tells us that the model would profit most from adding the variable <span class="math inline">\(Lwa\)</span> , as this would would minimize the <span class="math inline">\(AIC\)</span> to a value of <code>-7.1</code> and the sum of squared residuals <span class="math inline">\(RSS\)</span> to a value of <code>19.4</code>. The resulting model is considered better if its <span class="math inline">\(AIC\)</span> is lower than the one of the original model whose performance can be read from the first line of the table, with the label <code>&lt;none&gt;</code>.</p>
</div>
<div id="manual-backward-selection" class="section level4" number="4.1.4.2">
<h4><span class="header-section-number">4.1.4.2</span> Manual backward selection</h4>
<p>When starting from a complex model with several predictors the function <code>drop1()</code> can be used to remove the least significant variable. The resulting model is again considered better if its <span class="math inline">\(AIC\)</span> is lower than the one of the original model. This procedure is called <em>backward selection</em>.</p>
<p>Care shall be taken when fitting a full model that contains all catchment characteristics, as some of them are usually correlated, leading to a problem known as multicollinearity. Multicollinearity harms parameter estimation and leads to overfitted models, whose parameters are ill-deterimined and have little physical significance. In our case, minimum, maximum and range of altitude are exactly collinear, which means that one of the three variables can be dropped without any loss of information. Other variables respresenting precipitation, geology, altitude, and other landscape characteristics are likely to be collinear as well. As a consequence, we should not fit a model to the full set of catchment characteristics available for the study area.</p>
<p>Likewise, the backward selection needs to start with a well-defined model. Let us therfore assume that we whant to test a model consiting of the five variables <span class="math inline">\(P\)</span>, <span class="math inline">\(Hm\)</span>, <span class="math inline">\(Sm\)</span>, <span class="math inline">\(Gq\)</span>, <span class="math inline">\(Lf\)</span>, which represent different types of catchment characteristics.</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="chapter-8.html#cb188-1" aria-hidden="true" tabindex="-1"></a>model.full <span class="ot">&lt;-</span> <span class="fu">lm</span>(q95 <span class="sc">~</span> P <span class="sc">+</span> Hm <span class="sc">+</span> Sm <span class="sc">+</span> Gq <span class="sc">+</span> Lf, <span class="at">data =</span> x)</span></code></pre></div>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="chapter-8.html#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="fu">drop1</span>(model.full)</span></code></pre></div>
<pre><code>## Single term deletions
## 
## Model:
## q95 ~ P + Hm + Sm + Gq + Lf
##        Df Sum of Sq    RSS    AIC
## &lt;none&gt;              21.482 1.9807
## P       1    3.6279 25.110 4.6621
## Hm      1    0.1626 21.645 0.2069
## Sm      1    0.3249 21.807 0.4311
## Gq      1    2.3095 23.792 3.0441
## Lf      1    0.3547 21.837 0.4721</code></pre>
<p>The above table tells us that among all single term deletions the model without <span class="math inline">\(Hm\)</span> would have the the lowest <span class="math inline">\(AIC\)</span> = <code>0.21</code> and the lowest sum of squared residuals RSS = <code>21.6</code> . This means that dropping <span class="math inline">\(Hm\)</span> would significantly improve the model.</p>
</div>
<div id="automated-variable-selection" class="section level4" number="4.1.4.3">
<h4><span class="header-section-number">4.1.4.3</span> Automated variable selection</h4>
<p>Single variable addition and deletion can be used repeatedly unless any removal or addition of a variable would result in an increase of the <span class="math inline">\(AIC\)</span> and therefore in an inferior model. Such an automated variable selection is performed by the fuction <code>step</code>. Its argument <code>direction</code> specifies the mode of stepwise search: <code>foreward</code>, <code>backward</code> and <code>both</code> directions (default).</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="chapter-8.html#cb191-1" aria-hidden="true" tabindex="-1"></a>lm.both <span class="ot">&lt;-</span> <span class="fu">step</span>(model.init, <span class="at">scope =</span> scope, <span class="at">direction =</span> <span class="st">&quot;both&quot;</span>, <span class="at">trace =</span> <span class="dv">0</span>) </span>
<span id="cb191-2"><a href="chapter-8.html#cb191-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm.both)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = q95 ~ Lwa + Ggs + Sm + Gc, data = x)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -1.23854 -0.43772 -0.09556  0.34741  1.43576 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -0.371534   0.341822  -1.087 0.287439    
## Lwa          2.640617   0.586619   4.501 0.000136 ***
## Ggs          0.046486   0.010115   4.596 0.000106 ***
## Sm           0.144978   0.051626   2.808 0.009524 ** 
## Gc           0.015409   0.007758   1.986 0.058088 .  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.6623 on 25 degrees of freedom
## Multiple R-squared:  0.6817, Adjusted R-squared:  0.6307 
## F-statistic: 13.38 on 4 and 25 DF,  p-value: 5.817e-06</code></pre>
<p>The resulting model consists of four predictors <span class="math inline">\(Lwa, Ggs, Sm, Gc\)</span> and exhibits a coefficient of determination of <span class="math inline">\(R^2 = 0.69\)</span>, which is a major improvement over the simple linear regression model based on <span class="math inline">\(P\)</span>.</p>
</div>
<div id="plotting-the-results" class="section level4" number="4.1.4.4">
<h4><span class="header-section-number">4.1.4.4</span> Plotting the results</h4>
<p>One can show the model performance in a scatter plot by printing the predicted values of <span class="math inline">\(q_{95}\)</span> against the actual, observed values.</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="chapter-8.html#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">pty=</span><span class="st">&quot;s&quot;</span>)</span>
<span id="cb193-2"><a href="chapter-8.html#cb193-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> x<span class="sc">$</span>q95, <span class="at">y =</span> <span class="fu">fitted</span>(lm.both), <span class="at">xlab =</span> <span class="st">&quot;observed q95&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;predicted q95&quot;</span>)</span>
<span id="cb193-3"><a href="chapter-8.html#cb193-3" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="fu">lsfit</span>(lm.both<span class="sc">$</span>model<span class="sc">$</span>q95, lm.both<span class="sc">$</span>fitted.values))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-158-1.png" width="672" /></p>
<p>To depict the contribution of each predictor <span class="math inline">\(x_j\)</span> to the estimated <span class="math inline">\(q95\)</span> the function <code>termplot()</code> plots each regression term (<span class="math inline">\(\beta_j \cdot x_j\)</span>) against its predictor. All four predictor variables exhibit a positive influence on low flows, but the quality of the relationship differs greatly. For <span class="math inline">\(L_{wa}\)</span> the value of the predictor is <code>0</code> for most cases, so the term only affects very few catchments that have a water surface area greater than zero. At the other end of the spectrum is <span class="math inline">\(S_m\)</span> which exhibits a positive linear effect for the entire data set. The predictors <span class="math inline">\(G_c\)</span> and <span class="math inline">\(G_s\)</span> exhibit a linear effect for the majority of catchments and are thus in between these cases.</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="chapter-8.html#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb194-2"><a href="chapter-8.html#cb194-2" aria-hidden="true" tabindex="-1"></a><span class="fu">termplot</span>(lm.both, <span class="at">partial.resid =</span> <span class="cn">TRUE</span>) </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-159-1.png" width="672" /></p>
<p>As a final step, the assumptions of the model need to be checked by diagnostic plots.</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="chapter-8.html#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb195-2"><a href="chapter-8.html#cb195-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lm.both)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-160-1.png" width="672" /></p>
</div>
</div>
<div id="remove-outliers-based-on-cooks-distance" class="section level3" number="4.1.5">
<h3><span class="header-section-number">4.1.5</span> Remove outliers based on Cook’s distance</h3>
<p>In the diagnostic plot of the final model obtained by stepwise regression the station with id number <code>207985</code> popped out because of its high Cook’s distance of <code>2.39</code>. Such points can can act as leverage points and force the model to get close to them. The model is then too much representing single observations rather than providing an ovarall representation of the data set. In the Cook’s distance method the levereage points are held out from model fitting to perform robust parameter estimation.</p>
<p>The analysis is conducted in 3 steps (that may be repeated until no outliers remain…)</p>
<ol start="11" class="example" style="list-style-type: decimal">
<li>Detect outliers based on Cook’s distance. You can do this either by looking a the diagnostic plot or by subsetting the result of the function <code>cooks.distance()</code>. Let’s for example eliminate all outliers with an absolute Cook’s distance larger than 1.</li>
</ol>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="chapter-8.html#cb196-1" aria-hidden="true" tabindex="-1"></a>pos <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">abs</span>(<span class="fu">cooks.distance</span>(lm.both)) <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb196-2"><a href="chapter-8.html#cb196-2" aria-hidden="true" tabindex="-1"></a>pos</span></code></pre></div>
<pre><code>## 207985 
##     12</code></pre>
<p>In our data set this is the station with the id number <code>207985</code>, which is observation number (row number) <code>12</code>.</p>
<ol start="12" class="example" style="list-style-type: decimal">
<li>Now we can eliminate the outliers manually, by removing this row.</li>
</ol>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="chapter-8.html#cb198-1" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> x[<span class="sc">-</span>pos, ]</span>
<span id="cb198-2"><a href="chapter-8.html#cb198-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(x1)</span></code></pre></div>
<pre><code>## [1] 29 29</code></pre>
<ol start="13" class="example" style="list-style-type: decimal">
<li>Finally we have to re-run our stepwise regression model.</li>
</ol>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="chapter-8.html#cb200-1" aria-hidden="true" tabindex="-1"></a>lm.new <span class="ot">&lt;-</span> <span class="fu">step</span>(<span class="fu">lm</span>(q95 <span class="sc">~</span> P, <span class="at">data =</span> x1), <span class="at">scope =</span> scope, <span class="at">trace =</span> <span class="dv">0</span>) </span>
<span id="cb200-2"><a href="chapter-8.html#cb200-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm.new)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = q95 ~ Ggs + Gc + Sm + H0, data = x1)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.98559 -0.44049  0.03207  0.20995  1.33798 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -0.779134   0.413641  -1.884  0.07179 .  
## Ggs          0.051168   0.008710   5.875 4.64e-06 ***
## Gc           0.015331   0.006568   2.334  0.02829 *  
## Sm           0.126060   0.043808   2.878  0.00829 ** 
## H0           0.002155   0.001134   1.901  0.06932 .  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.5597 on 24 degrees of freedom
## Multiple R-squared:  0.7192, Adjusted R-squared:  0.6724 
## F-statistic: 15.37 on 4 and 24 DF,  p-value: 2.31e-06</code></pre>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="chapter-8.html#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb202-2"><a href="chapter-8.html#cb202-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lm.new)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-164-1.png" width="672" /></p>
<p>The so obtained model is free of leverage points and consists of a slightly different parameter set. The coefficient of determination is somewhat higher than the privious stepwise regression model, but needs to be interpreted with care as it is not evaluated for the entire data set.</p>
</div>
<div id="robust-regression-alternative-to-manual-outlier-detection" class="section level3" number="4.1.6">
<h3><span class="header-section-number">4.1.6</span> Robust regression (alternative to manual outlier detection)</h3>
<p>Robust regression can be used as an alternative to manual outlier detection. A number of methods exist. Some of the methods, however, tend to be more sensitive to outliers than to leverage points, and will therefore be less suited than the Cook’s distance method. We use here an MM-type estimator, which constitutes the current standard in <span class="math inline">\(R\)</span>’s <code>robustbase</code> package. The estimator performs a maximum-likelihood type estimation that is highly efficient and robust to leverage points as well.</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="chapter-8.html#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(robustbase)</span>
<span id="cb203-2"><a href="chapter-8.html#cb203-2" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> q95 <span class="sc">~</span> Ggs <span class="sc">+</span> Gc <span class="sc">+</span> Sm <span class="sc">+</span> H0</span>
<span id="cb203-3"><a href="chapter-8.html#cb203-3" aria-hidden="true" tabindex="-1"></a>x.rob <span class="ot">&lt;-</span> <span class="fu">lmrob</span>(<span class="at">formula =</span> model, <span class="at">data =</span> x)</span>
<span id="cb203-4"><a href="chapter-8.html#cb203-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(x.rob)</span></code></pre></div>
<pre><code>## 
## Call:
## lmrob(formula = model, data = x)
##  \--&gt; method = &quot;MM&quot;
## Residuals:
##       Min        1Q    Median        3Q       Max 
## -1.776957 -0.195700  0.002921  0.230256  3.497841 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)   
## (Intercept) -0.412840   0.352664  -1.171  0.25279   
## Ggs          0.044156   0.015161   2.913  0.00744 **
## Gc           0.033787   0.011066   3.053  0.00531 **
## Sm           0.058597   0.037087   1.580  0.12668   
## H0           0.002044   0.000553   3.697  0.00107 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Robust residual standard error: 0.3287 
## Multiple R-squared:  0.8415, Adjusted R-squared:  0.8161 
## Convergence in 31 IRWLS iterations
## 
## Robustness weights: 
##  3 observations c(1,12,25) are outliers with |weight| = 0 ( &lt; 0.0033); 
##  2 weights are ~= 1. The remaining 25 ones are summarized as
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##  0.1881  0.8252  0.9559  0.8734  0.9916  0.9987 
## Algorithmic parameters: 
##        tuning.chi                bb        tuning.psi        refine.tol           rel.tol 
##         1.548e+00         5.000e-01         4.685e+00         1.000e-07         1.000e-07 
##         scale.tol         solve.tol       eps.outlier             eps.x warn.limit.reject 
##         1.000e-10         1.000e-07         3.333e-03         9.695e-10         5.000e-01 
## warn.limit.meanrw 
##         5.000e-01 
##      nResample         max.it       best.r.s       k.fast.s          k.max    maxit.scale 
##            500             50              2              1            200            200 
##      trace.lev            mts     compute.rd fast.s.large.n 
##              0           1000              0           2000 
##                   psi           subsampling                   cov compute.outlier.stats 
##            &quot;bisquare&quot;         &quot;nonsingular&quot;         &quot;.vcov.avar1&quot;                  &quot;SM&quot; 
## seed : int(0)</code></pre>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="chapter-8.html#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x.rob)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-165-1.png" width="672" /><img src="_main_files/figure-html/unnamed-chunk-165-2.png" width="672" /><img src="_main_files/figure-html/unnamed-chunk-165-3.png" width="672" /><img src="_main_files/figure-html/unnamed-chunk-165-4.png" width="672" /><img src="_main_files/figure-html/unnamed-chunk-165-5.png" width="672" /></p>
<p>We can see that the robust MM-estimator leads to a well-fitted model with a low <span class="math inline">\(RMSE\)</span> and a high <span class="math inline">\(R^2\)</span>. Note, however, that the fit statistics of the robust regression method are not fully comparable with those of the standard regression method as outliers are downweigted in the parameter estimation and will receive lower weight in the fit statistics as well. The residual plots allow a direct comparison among different models. Compared to standard OLS-regression, the MM-estimator performs much better for the majority of cases while showing poor fit for extreme outliers. Leverage points appear to have little impact on the model.</p>
</div>
<div id="references" class="section level3" number="4.1.7">
<h3><span class="header-section-number">4.1.7</span> References</h3>
<ul>
<li>Laaha, G. &amp; Blöschl, G. (2006a) Seasonality indices for regionalizing low flows. Hydrol. Process. 20(18), 3851-3878. <a href="doi:10.1002/hyp.6161" class="uri">doi:10.1002/hyp.6161</a></li>
<li>Laaha, G. &amp; Blöschl, G. (2006b) A comparison of low flow regionalisation methods-catchment grouping. J. Hydrol. 323(1-4), 193-214. <a href="doi:10.1016/j.jhydrol.2005.09.001" class="uri">doi:10.1016/j.jhydrol.2005.09.001</a></li>
</ul>
</div>
</div>
<div id="worked-example-8.2-top-kriging" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Worked example 8.2: Top-kriging</h2>
<div id="introduction-1" class="section level3" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> Introduction</h3>
<p>This vignette demonstrates the application of Top-kriging presented in Skøien et al. (2006, 2014) to model low flows along the stream network. We use a dataset of 30 gauged and 373 ungauged catchments situated in the forelands and pre-Alps in the north-east of Austria, for details see Section 4.5.2. The target variable is the long-term low flow characteristic <span class="math inline">\(q_{95}\)</span>, i.e. <span class="math inline">\(Q_{95}\)</span> standardized by catchment area. The data consist of overlapping catchment polygons provided in two Shapefiles, the first containing the observed catchments only, the second containing all catchments (prediction locations incl. observed catchments).</p>
<p>In this worked example, we learn</p>
<ul>
<li>how to import SpatialPolygonDataFrames and store them as an rtopObj,</li>
<li>perform explorative statistics and conduct variogram analysis,</li>
<li>fit a variogram model and employ kriging to perform prediction to catchments along the stream network</li>
<li>perform cross-validation,</li>
<li>and create low flow maps of observed and predicted values.</li>
</ul>
</div>
<div id="data-import-1" class="section level3" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> Data import</h3>
<p>We will use the <code>rtop</code> package to perform kriging along the river network and the package <code>rgdal</code> for handling geospatial data.
We load the packages (after installation at first use).</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="chapter-8.html#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rtop)</span>
<span id="cb206-2"><a href="chapter-8.html#cb206-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span></code></pre></div>
<div id="reading-shapefiles" class="section level4" number="4.2.2.1">
<h4><span class="header-section-number">4.2.2.1</span> Reading Shapefiles</h4>
<p>The methods used here take the catchment topology into account. Our data are therefore Shapefiles that contain the (overlapping) catchment polygons together with an attribute table containing the low flow index and other catchment information. The data is provided in two files. The first file named ´File1.shp´ contains the 30 observed catchments and is used for model fitting. The second one named ´File2.shp´ contains the whole data set (prediction locations incl. observed catchments) and is used for the prediction.</p>
<p>For the import, we first set the path of the data directory where the Shapefiles are stored:</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="chapter-8.html#cb207-1" aria-hidden="true" tabindex="-1"></a>rpath <span class="ot">&lt;-</span> <span class="st">&quot;../../data/catchment_shape_files&quot;</span></span></code></pre></div>
<p>We can now read the Shapefile containing the observation dataset.</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="chapter-8.html#cb208-1" aria-hidden="true" tabindex="-1"></a>x.obs <span class="ot">&lt;-</span> <span class="fu">readOGR</span>(rpath,<span class="st">&quot;File1&quot;</span>)</span></code></pre></div>
<pre><code>## OGR data source with driver: ESRI Shapefile 
## Source: &quot;/run/media/jhstagge/2DD2A9A003BF0188/Documents/work_folder/projects_research/code/hydroDrought/data/catchment_shape_files&quot;, layer: &quot;File1&quot;
## with 30 features
## It has 6 fields</code></pre>
<!-- x.obs <- readOGR(rpath,"Watershed_Gesamt_zone1_nwkenn_OBS") # Former name of observation data set -->
<p>We then create a new column <code>x.obs$obs</code> that shall contain the observed values of our target variable. Note that top-kriging requires the flow characteristic standardized per unit area (specific discharge in <span class="math inline">\(l s^{-1} km^{-2}\)</span>), which may need to be calculated from absolute discharge values. In our case, the observed values of specific low flow <code>x.obs$Q95S</code> are simply assigned to the newly created column <code>x.obs$obs</code>.</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="chapter-8.html#cb210-1" aria-hidden="true" tabindex="-1"></a>x.obs<span class="sc">$</span>obs <span class="ot">&lt;-</span> x.obs<span class="sc">$</span>Q95S</span></code></pre></div>
<p>The imported object belongs to the <code>SpatialPolygonsDataFrame</code>-class, which consists of 5 slots. We can access each slot (using “@”). This allows us to check the data structure of the attribute table:</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="chapter-8.html#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="fu">slotNames</span>(x.obs)</span></code></pre></div>
<pre><code>## [1] &quot;data&quot;        &quot;polygons&quot;    &quot;plotOrder&quot;   &quot;bbox&quot;        &quot;proj4string&quot;</code></pre>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="chapter-8.html#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(x.obs<span class="sc">@</span>data)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    30 obs. of  7 variables:
##  $ EZGID     : num  696 1887 1954 2058 2960 ...
##  $ HZBNR     : num  208108 208512 208678 208447 211508 ...
##  $ SHAPE_AREA: num  6.07e+07 6.47e+07 7.20e+07 1.31e+08 1.42e+08 ...
##  $ AREASQKM  : num  60.7 64.7 72 130.6 142.3 ...
##  $ Q95       : num  0.06 0.06 0.05 0.05 0.11 0.14 0.14 0.08 0.2 0.16 ...
##  $ Q95S      : num  0.98 0.96 0.75 0.38 0.91 1.2 0.95 0.61 1.07 1.79 ...
##  $ obs       : num  0.98 0.96 0.75 0.38 0.91 1.2 0.95 0.61 1.07 1.79 ...</code></pre>
<p>The import and preparation of the prediction dataset is done analogously.</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="chapter-8.html#cb215-1" aria-hidden="true" tabindex="-1"></a>x.pred <span class="ot">=</span> <span class="fu">readOGR</span>(rpath,<span class="st">&quot;File2&quot;</span>)</span></code></pre></div>
<pre><code>## OGR data source with driver: ESRI Shapefile 
## Source: &quot;/run/media/jhstagge/2DD2A9A003BF0188/Documents/work_folder/projects_research/code/hydroDrought/data/catchment_shape_files&quot;, layer: &quot;File2&quot;
## with 404 features
## It has 6 fields</code></pre>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="chapter-8.html#cb217-1" aria-hidden="true" tabindex="-1"></a>x.pred<span class="sc">$</span>obs <span class="ot">&lt;-</span> x.pred<span class="sc">$</span>Q95S <span class="co"># also in x.pred for ploting</span></span></code></pre></div>
<!-- x.pred = readOGR(rpath,"Watershed_Gesamt_zone1_nwkenn_PRED_BIG3") # Former name of prediction data set -->
</div>
<div id="creating-an-rtopobj" class="section level4" number="4.2.2.2">
<h4><span class="header-section-number">4.2.2.2</span> Creating an rtopObj</h4>
<p>The easiest way to use the functionality of the <em>rtop</em>-package is to create a particular <em>rtop</em>-object. In this step, we need to specify the <code>observations</code> and the <code>predictionLocations</code> object and use the <code>formulaString</code> argument to define the dependent variable and the kriging method. We use <code>obs~1</code> to perform ordinary Top-kriging of a dependent variable <code>obs</code>. For large data sets this step may be time consuming so it is recommended to set the option <code>gdist=TRUE</code> to calculate a simplified distance measure that will reduce computation time.</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="chapter-8.html#cb218-1" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">gDist =</span> <span class="cn">TRUE</span>)</span>
<span id="cb218-2"><a href="chapter-8.html#cb218-2" aria-hidden="true" tabindex="-1"></a>rtopObj <span class="ot">&lt;-</span> <span class="fu">createRtopObject</span>(<span class="at">observations=</span>x.obs, <span class="at">predictionLocations=</span>x.pred, <span class="at">formulaString =</span> obs<span class="sc">~</span><span class="dv">1</span>, <span class="at">params =</span> params)</span>
<span id="cb218-3"><a href="chapter-8.html#cb218-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(rtopObj)</span></code></pre></div>
<pre><code>## [1] &quot;observations&quot;        &quot;predictionLocations&quot; &quot;formulaString&quot;       &quot;params&quot;</code></pre>
<p>For most functions, the parameters can either be set directly during the function call, or specified in a <code>params</code> list and set as default using the <code>params</code> argument.</p>
</div>
</div>
<div id="explorative-statistics" class="section level3" number="4.2.3">
<h3><span class="header-section-number">4.2.3</span> Explorative statistics</h3>
<div id="checking-the-low-flow-distribution" class="section level4" number="4.2.3.1">
<h4><span class="header-section-number">4.2.3.1</span> Checking the low flow distribution</h4>
<p>Before starting the geostatistical analysis we need to verify the basic assumption of kriging that data shall follow a Gaussian distribution to achieve best linear unbiased estimates. We see from the histograms that the raw data exhibit a skewed distribution so we test different variable transformations.</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="chapter-8.html#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(rtopObj<span class="sc">$</span>observations<span class="sc">$</span>obs)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-174-1.png" width="672" /></p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="chapter-8.html#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">log</span>(rtopObj<span class="sc">$</span>observations<span class="sc">$</span>obs))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-174-2.png" width="672" /></p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="chapter-8.html#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">sqrt</span>(rtopObj<span class="sc">$</span>observations<span class="sc">$</span>obs), <span class="at">breaks=</span><span class="dv">9</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-174-3.png" width="672" /></p>
<p>We can see that the sqrt-transformation performs somewhat better than the log-transformation to approximate a Gaussian distribution. Alternatively, the Box-Cox transformation (Section 7.X) can be used to fine-tune the transformation parameters to better approximate normality.</p>
</div>
<div id="data-transformation" class="section level4" number="4.2.3.2">
<h4><span class="header-section-number">4.2.3.2</span> Data transformation</h4>
<p>The best-performing transformation is then applied to the <code>obs</code> data slots, to transform the <code>observations</code> and <code>predictionLocations</code>in the <code>rtopObj</code>.</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="chapter-8.html#cb223-1" aria-hidden="true" tabindex="-1"></a>rtopObj<span class="sc">$</span>observations<span class="sc">$</span>obs <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(x.obs<span class="sc">$</span>Q95S)</span>
<span id="cb223-2"><a href="chapter-8.html#cb223-2" aria-hidden="true" tabindex="-1"></a>rtopObj<span class="sc">$</span>predictionLocations<span class="sc">$</span>obs <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(x.pred<span class="sc">$</span>Q95S)</span></code></pre></div>
<p>We finally review the observations in the <code>rtobObj</code> to ensure that our transformation was successful.</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="chapter-8.html#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(rtopObj<span class="sc">$</span>observations<span class="sc">$</span>obs, <span class="at">nclass=</span><span class="dv">9</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-176-1.png" width="672" /></p>
</div>
<div id="summary-statistics" class="section level4" number="4.2.3.3">
<h4><span class="header-section-number">4.2.3.3</span> Summary statistics</h4>
<p>We compute summary statistics to provide insight into the distribution of the (transformed) low flow data.</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="chapter-8.html#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(rtopObj<span class="sc">$</span>observations<span class="sc">$</span>obs)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##  0.3317  0.8077  0.9849  1.1190  1.3407  2.0298</code></pre>
</div>
<div id="ploting-the-data" class="section level4" number="4.2.3.4">
<h4><span class="header-section-number">4.2.3.4</span> Ploting the data</h4>
<p>In a final explorative assessment, the values are presented in a geographic map to provide a first impression about the spatial distribution of low flows in the study area. In the left panel we show the untransformed specific low flows, in the right panel the transformed values. We can observe a spatial pattern of decreasing low flows from west to east. The highest values can be found in the south-west in a low-mountain range of about 1000 m altitude.</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="chapter-8.html#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="fu">spplot</span>(<span class="at">obj=</span>rtopObj<span class="sc">$</span>observations, <span class="at">col.regions =</span> <span class="fu">rev</span>(<span class="fu">heat.colors</span>(<span class="at">n=</span><span class="dv">100</span>)), <span class="at">col=</span><span class="st">&quot;grey&quot;</span>,</span>
<span id="cb227-2"><a href="chapter-8.html#cb227-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">c</span>(<span class="st">&quot;Q95S&quot;</span>, <span class="st">&quot;obs&quot;</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-178-1.png" width="672" /></p>
</div>
</div>
<div id="variogram-analysis" class="section level3" number="4.2.4">
<h3><span class="header-section-number">4.2.4</span> Variogram analysis</h3>
<p>As in classical geostatistics, the variogram analysis proceeds in two steps. We first calculate the sample variogram representing the spatial correlation structure of observed low flow characteristics. We then fit a theoretical variogram model to the sample variogram, which is used to estimate the optimal weights for the kriging estimator.</p>
<div id="sample-variogram" class="section level4" number="4.2.4.1">
<h4><span class="header-section-number">4.2.4.1</span> Sample variogram</h4>
<p>A call to <code>rtopVariogram</code> adds the sample variogram to the <code>rtopObj</code>. The package supports both binned variograms and variogram clouds.</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="chapter-8.html#cb228-1" aria-hidden="true" tabindex="-1"></a>rtopObj <span class="ot">&lt;-</span> <span class="fu">rtopVariogram</span>(rtopObj, <span class="at">cloud=</span><span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<div id="theoretical-variogram-various-support" class="section level4" number="4.2.4.2">
<h4><span class="header-section-number">4.2.4.2</span> Theoretical variogram (various support)</h4>
<p>As opposed to ordinary kriging, the theoretical point variogram of Top-kriging cannot be fitted directly to the sample data, due to the different support of the observations. Instead, the function <code>fitVariogram</code> optimizes a point variogram model whose regularized semivariogram values yield best fit to the sample variogram values. This is performed in a iterative procedure, known as <em>back-calculation</em>.</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="chapter-8.html#cb229-1" aria-hidden="true" tabindex="-1"></a>rtopObj <span class="ot">&lt;-</span> <span class="fu">rtopFitVariogram</span>(rtopObj)</span></code></pre></div>
<pre><code>## 54 best 0.804 function convergence 200 parameter convergence 6899.17 
## 88 best 0.804 function convergence 200 parameter convergence 6225.306 
## 122 best 0.197 function convergence 200 parameter convergence 3771.668 
## 152 best 0.197 function convergence 200 parameter convergence 2991.341 
## 180 best 0.196 function convergence 200 parameter convergence 1974.043 
## 215 best 0.194 function convergence 122 parameter convergence 1473.692 
## 248 best 0.194 function convergence 122 parameter convergence 1281.325 
## 286 best 0.194 function convergence 1.6 parameter convergence 968.2604 
## 317 best 0.194 function convergence 1.6 parameter convergence 690.5949 
## 346 best 0.194 function convergence 1.32 parameter convergence 475.3911 
## 377 best 0.194 function convergence 0.111 parameter convergence 384.2278 
## 405 best 0.194 function convergence 0.138 parameter convergence 359.3354 
## 433 best 0.194 function convergence 0.182 parameter convergence 293.74 
## 458 best 0.194 function convergence 0.21 parameter convergence 234.4413 
## 486 best 0.193 function convergence 0.206 parameter convergence 137.7318 
## 512 best 0.193 function convergence 0.139 parameter convergence 100.9305 
## 538 best 0.193 function convergence 0.118 parameter convergence 88.53901 
## 563 best 0.193 function convergence 0.0776 parameter convergence 71.64833 
## 590 best 0.193 function convergence 0.0527 parameter convergence 72.78624 
## 615 best 0.193 function convergence 0.0275 parameter convergence 73.7052 
## 641 best 0.193 function convergence 0.0151 parameter convergence 51.43452 
## 666 best 0.193 function convergence 0.0122 parameter convergence 45.75847 
## 691 best 0.193 function convergence 0.0119 parameter convergence 26.3961 
## 716 best 0.193 function convergence 0.0096 parameter convergence 15.17652 
## 741 best 0.193 function convergence 0.00952 parameter convergence 12.11683 
## 766 best 0.193 function convergence 0.00877 parameter convergence 11.05402 
## 791 best 0.193 function convergence 0.00572 parameter convergence 8.932906 
## 816 best 0.193 function convergence 0.00232 parameter convergence 8.416286 
## 841 best 0.193 function convergence 0.00107 parameter convergence 4.746293 
## 866 best 0.193 function convergence 0.00053 parameter convergence 3.017097 
## 891 best 0.193 function convergence 0.000245 parameter convergence 3.06958 
## 917 best 0.193 function convergence 0.000107 parameter convergence 3.077476 
## 944 best 0.193 function convergence 5.48e-05 parameter convergence 2.489709 
## 969 best 0.193 function convergence 2.12e-05 parameter convergence 2.449601 
## 994 best 0.193 function convergence 1.05e-05 parameter convergence 2.248206 
## 1019 best 0.193 function convergence 8.86e-06 parameter convergence 2.363279 
## 1044 best 0.193 function convergence 6.36e-06 parameter convergence 1.920502 
## 1069 best 0.193 function convergence 4.18e-06 parameter convergence 1.322981 
## 1094 best 0.193 function convergence 3.65e-06 parameter convergence 0.7510446</code></pre>
<p>The function checkVario generates some diagnostic plots that are usful in variogram analysis. The first two explore the data before variogram fitting, whereas the last two show the correspondence between the sample variogram and the fitted variogram.</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="chapter-8.html#cb231-1" aria-hidden="true" tabindex="-1"></a><span class="fu">checkVario</span>(rtopObj, <span class="at">cloud=</span><span class="cn">TRUE</span>, <span class="at">identify=</span><span class="cn">TRUE</span>, <span class="at">acor=</span><span class="fl">0.000001</span>, <span class="at">legx=</span><span class="dv">39000</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-181-1.png" width="672" /></p>
<pre><code>## [1] &quot;cloud is  TRUE&quot;
## [1] &quot;Creating cloud variogram; this might take some time&quot;
## [1] &quot;Sampling points from  30 areas&quot;
## 
  |                                                                                                
  |                                                                                          |   0%
  |                                                                                                
  |===                                                                                       |   3%
  |                                                                                                
  |======                                                                                    |   7%
  |                                                                                                
  |=========                                                                                 |  10%
  |                                                                                                
  |============                                                                              |  14%
  |                                                                                                
  |================                                                                          |  17%
  |                                                                                                
  |===================                                                                       |  21%
  |                                                                                                
  |======================                                                                    |  24%
  |                                                                                                
  |=========================                                                                 |  28%
  |                                                                                                
  |============================                                                              |  31%
  |                                                                                                
  |===============================                                                           |  34%
  |                                                                                                
  |==================================                                                        |  38%
  |                                                                                                
  |=====================================                                                     |  41%
  |                                                                                                
  |========================================                                                  |  45%
  |                                                                                                
  |===========================================                                               |  48%
  |                                                                                                
  |===============================================                                           |  52%
  |                                                                                                
  |==================================================                                        |  55%
  |                                                                                                
  |=====================================================                                     |  59%
  |                                                                                                
  |========================================================                                  |  62%
  |                                                                                                
  |===========================================================                               |  66%
  |                                                                                                
  |==============================================================                            |  69%
  |                                                                                                
  |=================================================================                         |  72%
  |                                                                                                
  |====================================================================                      |  76%
  |                                                                                                
  |=======================================================================                   |  79%
  |                                                                                                
  |==========================================================================                |  83%
  |                                                                                                
  |==============================================================================            |  86%
  |                                                                                                
  |=================================================================================         |  90%
  |                                                                                                
  |====================================================================================      |  93%
  |                                                                                                
  |=======================================================================================   |  97%
  |                                                                                                
  |==========================================================================================| 100%
## [1] &quot;Sampled on average 217.1 points from 30 areas&quot;</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-181-2.png" width="672" /><img src="_main_files/figure-html/unnamed-chunk-181-3.png" width="672" /></p>
<pre><code>## [1] &quot;Sampling points from  6 areas&quot;
## 
  |                                                                                                
  |                                                                                          |   0%
  |                                                                                                
  |==================                                                                        |  20%
  |                                                                                                
  |====================================                                                      |  40%
  |                                                                                                
  |======================================================                                    |  60%
  |                                                                                                
  |========================================================================                  |  80%
  |                                                                                                
  |==========================================================================================| 100%
## [1] &quot;Sampled on average 196 points from 6 areas&quot;
## [1] &quot;Sampling points from  7 areas&quot;
## 
  |                                                                                                
  |                                                                                          |   0%
  |                                                                                                
  |===============                                                                           |  17%
  |                                                                                                
  |==============================                                                            |  33%
  |                                                                                                
  |=============================================                                             |  50%
  |                                                                                                
  |============================================================                              |  67%
  |                                                                                                
  |===========================================================================               |  83%
  |                                                                                                
  |==========================================================================================| 100%
## [1] &quot;Sampled on average 141.86 points from 7 areas&quot;
## [1] &quot;Sampling points from  7 areas&quot;
## 
  |                                                                                                
  |                                                                                          |   0%
  |                                                                                                
  |===============                                                                           |  17%
  |                                                                                                
  |==============================                                                            |  33%
  |                                                                                                
  |=============================================                                             |  50%
  |                                                                                                
  |============================================================                              |  67%
  |                                                                                                
  |===========================================================================               |  83%
  |                                                                                                
  |==========================================================================================| 100%
## [1] &quot;Sampled on average 198 points from 7 areas&quot;
## [1] &quot;Sampling points from  7 areas&quot;
## 
  |                                                                                                
  |                                                                                          |   0%
  |                                                                                                
  |===============                                                                           |  17%
  |                                                                                                
  |==============================                                                            |  33%
  |                                                                                                
  |=============================================                                             |  50%
  |                                                                                                
  |============================================================                              |  67%
  |                                                                                                
  |===========================================================================               |  83%
  |                                                                                                
  |==========================================================================================| 100%
## [1] &quot;Sampled on average 185.29 points from 7 areas&quot;
## [1] &quot;Sampling points from  7 areas&quot;
## 
  |                                                                                                
  |                                                                                          |   0%
  |                                                                                                
  |===============                                                                           |  17%
  |                                                                                                
  |==============================                                                            |  33%
  |                                                                                                
  |=============================================                                             |  50%
  |                                                                                                
  |============================================================                              |  67%
  |                                                                                                
  |===========================================================================               |  83%
  |                                                                                                
  |==========================================================================================| 100%
## [1] &quot;Sampled on average 145 points from 7 areas&quot;</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-181-4.png" width="672" /></p>
<p>We can see from the first plot the relationship between the variance of observations (known as dispersion variance) and catchment area, with the size of circles proportional to the number of observations in each area class. One of the assumptions of Top-kriging is that the dispersion variance decreases with increasing area, what should be visible from the figure. In our case the evidence is quite uncertain due to limited data in most area classes.</p>
<p>The second plot shows the variogram cloud where each point represents a pair of catchments. The cloud is useful for identifying outliers that should be discarded from variogram analysis to foster robust parameter estimation. Our plot shows a typical decrease of dissimilarity at larger distances. There is no evidence for outliers (such as strata of high semivariances for data pairs attributed to an extreme observation).</p>
<p>The third plot shows a (log–log scaled) scatter plot of theoretical (regularized) semivariogram values from a fitted variogram model vs. the sample variogram values. The size of the circles is relative to the number of pairs in each bin. A cloud close to the 1:1 line indicates a good model fit. In our case the model (regularized gamma) deviates from the sample for small semivariances values, while showing a fairly good fit for the remaining range of the variogram.</p>
<p>The fourth plot shows the (tree-dimensional) variogram model of Top-kriging, i.e. semivariance as a function of distance and area. Lines represent the theoretical variogram model, with solid lines representing regularized semivariograms of equally sized catchments and dotted lines representing combinations of catchments sizes. Points represent the sample variogram, with point size relative to the number of pairs in each bin. The plot shows a linear point-variogram and the decrease of semivariances with catchment area, as a consequence of regularization. The model shows a good fit for the most frequent area bin (300 vs 300 km) but does not fit well for area bins with a low observation frequency (e.g. 750 vs 750 km). Advanced methods for model fitting are presented in Laaha et al. (2013).</p>
</div>
</div>
<div id="kriging" class="section level3" number="4.2.5">
<h3><span class="header-section-number">4.2.5</span> Kriging</h3>
<p>The prediction function <code>rtopKrige</code> solves the kriging system based on the computed regularized semivariances. The covariance matrices are internally created by a separate regularization function (<code>varMat</code>), and stored in the <code>rtopObj</code> for easier access if it is necessary to redo parts of the analysis, as this is the computationally expensive part of the prediction.</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="chapter-8.html#cb234-1" aria-hidden="true" tabindex="-1"></a>rtopObj <span class="ot">&lt;-</span> <span class="fu">rtopKrige</span>(rtopObj)</span></code></pre></div>
<pre><code>## [1] &quot;Sampling points from  30 areas&quot;
## 
  |                                                                                                
  |                                                                                          |   0%
  |                                                                                                
  |===                                                                                       |   3%
  |                                                                                                
  |======                                                                                    |   7%
  |                                                                                                
  |=========                                                                                 |  10%
  |                                                                                                
  |============                                                                              |  14%
  |                                                                                                
  |================                                                                          |  17%
  |                                                                                                
  |===================                                                                       |  21%
  |                                                                                                
  |======================                                                                    |  24%
  |                                                                                                
  |=========================                                                                 |  28%
  |                                                                                                
  |============================                                                              |  31%
  |                                                                                                
  |===============================                                                           |  34%
  |                                                                                                
  |==================================                                                        |  38%
  |                                                                                                
  |=====================================                                                     |  41%
  |                                                                                                
  |========================================                                                  |  45%
  |                                                                                                
  |===========================================                                               |  48%
  |                                                                                                
  |===============================================                                           |  52%
  |                                                                                                
  |==================================================                                        |  55%
  |                                                                                                
  |=====================================================                                     |  59%
  |                                                                                                
  |========================================================                                  |  62%
  |                                                                                                
  |===========================================================                               |  66%
  |                                                                                                
  |==============================================================                            |  69%
  |                                                                                                
  |=================================================================                         |  72%
  |                                                                                                
  |====================================================================                      |  76%
  |                                                                                                
  |=======================================================================                   |  79%
  |                                                                                                
  |==========================================================================                |  83%
  |                                                                                                
  |==============================================================================            |  86%
  |                                                                                                
  |=================================================================================         |  90%
  |                                                                                                
  |====================================================================================      |  93%
  |                                                                                                
  |=======================================================================================   |  97%
  |                                                                                                
  |==========================================================================================| 100%
## [1] &quot;Sampled on average 217.1 points from 30 areas&quot;
## [1] &quot;Sampling points from  404 areas&quot;
## 
  |                                                                                                
  |                                                                                          |   0%
  |                                                                                                
  |=                                                                                         |   1%
  |                                                                                                
  |==                                                                                        |   2%
  |                                                                                                
  |==                                                                                        |   3%
  |                                                                                                
  |===                                                                                       |   3%
  |                                                                                                
  |===                                                                                       |   4%
  |                                                                                                
  |====                                                                                      |   4%
  |                                                                                                
  |====                                                                                      |   5%
  |                                                                                                
  |=====                                                                                     |   5%
  |                                                                                                
  |=====                                                                                     |   6%
  |                                                                                                
  |======                                                                                    |   6%
  |                                                                                                
  |======                                                                                    |   7%
  |                                                                                                
  |=======                                                                                   |   7%
  |                                                                                                
  |=======                                                                                   |   8%
  |                                                                                                
  |========                                                                                  |   8%
  |                                                                                                
  |========                                                                                  |   9%
  |                                                                                                
  |=========                                                                                 |  10%
  |                                                                                                
  |==========                                                                                |  11%
  |                                                                                                
  |==========                                                                                |  12%
  |                                                                                                
  |===========                                                                               |  12%
  |                                                                                                
  |===========                                                                               |  13%
  |                                                                                                
  |============                                                                              |  13%
  |                                                                                                
  |============                                                                              |  14%
  |                                                                                                
  |=============                                                                             |  14%
  |                                                                                                
  |=============                                                                             |  15%
  |                                                                                                
  |==============                                                                            |  15%
  |                                                                                                
  |==============                                                                            |  16%
  |                                                                                                
  |===============                                                                           |  16%
  |                                                                                                
  |===============                                                                           |  17%
  |                                                                                                
  |================                                                                          |  17%
  |                                                                                                
  |================                                                                          |  18%
  |                                                                                                
  |=================                                                                         |  18%
  |                                                                                                
  |=================                                                                         |  19%
  |                                                                                                
  |==================                                                                        |  20%
  |                                                                                                
  |===================                                                                       |  21%
  |                                                                                                
  |===================                                                                       |  22%
  |                                                                                                
  |====================                                                                      |  22%
  |                                                                                                
  |====================                                                                      |  23%
  |                                                                                                
  |=====================                                                                     |  23%
  |                                                                                                
  |=====================                                                                     |  24%
  |                                                                                                
  |======================                                                                    |  24%
  |                                                                                                
  |======================                                                                    |  25%
  |                                                                                                
  |=======================                                                                   |  25%
  |                                                                                                
  |=======================                                                                   |  26%
  |                                                                                                
  |========================                                                                  |  26%
  |                                                                                                
  |========================                                                                  |  27%
  |                                                                                                
  |=========================                                                                 |  27%
  |                                                                                                
  |=========================                                                                 |  28%
  |                                                                                                
  |==========================                                                                |  29%
  |                                                                                                
  |===========================                                                               |  30%
  |                                                                                                
  |===========================                                                               |  31%
  |                                                                                                
  |============================                                                              |  31%
  |                                                                                                
  |============================                                                              |  32%
  |                                                                                                
  |=============================                                                             |  32%
  |                                                                                                
  |=============================                                                             |  33%
  |                                                                                                
  |==============================                                                            |  33%
  |                                                                                                
  |==============================                                                            |  34%
  |                                                                                                
  |===============================                                                           |  34%
  |                                                                                                
  |===============================                                                           |  35%
  |                                                                                                
  |================================                                                          |  35%
  |                                                                                                
  |================================                                                          |  36%
  |                                                                                                
  |=================================                                                         |  36%
  |                                                                                                
  |=================================                                                         |  37%
  |                                                                                                
  |==================================                                                        |  37%
  |                                                                                                
  |==================================                                                        |  38%
  |                                                                                                
  |===================================                                                       |  38%
  |                                                                                                
  |===================================                                                       |  39%
  |                                                                                                
  |====================================                                                      |  39%
  |                                                                                                
  |====================================                                                      |  40%
  |                                                                                                
  |=====================================                                                     |  41%
  |                                                                                                
  |======================================                                                    |  42%
  |                                                                                                
  |======================================                                                    |  43%
  |                                                                                                
  |=======================================                                                   |  43%
  |                                                                                                
  |=======================================                                                   |  44%
  |                                                                                                
  |========================================                                                  |  44%
  |                                                                                                
  |========================================                                                  |  45%
  |                                                                                                
  |=========================================                                                 |  45%
  |                                                                                                
  |=========================================                                                 |  46%
  |                                                                                                
  |==========================================                                                |  46%
  |                                                                                                
  |==========================================                                                |  47%
  |                                                                                                
  |===========================================                                               |  47%
  |                                                                                                
  |===========================================                                               |  48%
  |                                                                                                
  |============================================                                              |  48%
  |                                                                                                
  |============================================                                              |  49%
  |                                                                                                
  |=============================================                                             |  50%
  |                                                                                                
  |==============================================                                            |  51%
  |                                                                                                
  |==============================================                                            |  52%
  |                                                                                                
  |===============================================                                           |  52%
  |                                                                                                
  |===============================================                                           |  53%
  |                                                                                                
  |================================================                                          |  53%
  |                                                                                                
  |================================================                                          |  54%
  |                                                                                                
  |=================================================                                         |  54%
  |                                                                                                
  |=================================================                                         |  55%
  |                                                                                                
  |==================================================                                        |  55%
  |                                                                                                
  |==================================================                                        |  56%
  |                                                                                                
  |===================================================                                       |  56%
  |                                                                                                
  |===================================================                                       |  57%
  |                                                                                                
  |====================================================                                      |  57%
  |                                                                                                
  |====================================================                                      |  58%
  |                                                                                                
  |=====================================================                                     |  59%
  |                                                                                                
  |======================================================                                    |  60%
  |                                                                                                
  |======================================================                                    |  61%
  |                                                                                                
  |=======================================================                                   |  61%
  |                                                                                                
  |=======================================================                                   |  62%
  |                                                                                                
  |========================================================                                  |  62%
  |                                                                                                
  |========================================================                                  |  63%
  |                                                                                                
  |=========================================================                                 |  63%
  |                                                                                                
  |=========================================================                                 |  64%
  |                                                                                                
  |==========================================================                                |  64%
  |                                                                                                
  |==========================================================                                |  65%
  |                                                                                                
  |===========================================================                               |  65%
  |                                                                                                
  |===========================================================                               |  66%
  |                                                                                                
  |============================================================                              |  66%
  |                                                                                                
  |============================================================                              |  67%
  |                                                                                                
  |=============================================================                             |  67%
  |                                                                                                
  |=============================================================                             |  68%
  |                                                                                                
  |==============================================================                            |  68%
  |                                                                                                
  |==============================================================                            |  69%
  |                                                                                                
  |===============================================================                           |  69%
  |                                                                                                
  |===============================================================                           |  70%
  |                                                                                                
  |================================================================                          |  71%
  |                                                                                                
  |=================================================================                         |  72%
  |                                                                                                
  |=================================================================                         |  73%
  |                                                                                                
  |==================================================================                        |  73%
  |                                                                                                
  |==================================================================                        |  74%
  |                                                                                                
  |===================================================================                       |  74%
  |                                                                                                
  |===================================================================                       |  75%
  |                                                                                                
  |====================================================================                      |  75%
  |                                                                                                
  |====================================================================                      |  76%
  |                                                                                                
  |=====================================================================                     |  76%
  |                                                                                                
  |=====================================================================                     |  77%
  |                                                                                                
  |======================================================================                    |  77%
  |                                                                                                
  |======================================================================                    |  78%
  |                                                                                                
  |=======================================================================                   |  78%
  |                                                                                                
  |=======================================================================                   |  79%
  |                                                                                                
  |========================================================================                  |  80%
  |                                                                                                
  |=========================================================================                 |  81%
  |                                                                                                
  |=========================================================================                 |  82%
  |                                                                                                
  |==========================================================================                |  82%
  |                                                                                                
  |==========================================================================                |  83%
  |                                                                                                
  |===========================================================================               |  83%
  |                                                                                                
  |===========================================================================               |  84%
  |                                                                                                
  |============================================================================              |  84%
  |                                                                                                
  |============================================================================              |  85%
  |                                                                                                
  |=============================================================================             |  85%
  |                                                                                                
  |=============================================================================             |  86%
  |                                                                                                
  |==============================================================================            |  86%
  |                                                                                                
  |==============================================================================            |  87%
  |                                                                                                
  |===============================================================================           |  87%
  |                                                                                                
  |===============================================================================           |  88%
  |                                                                                                
  |================================================================================          |  88%
  |                                                                                                
  |================================================================================          |  89%
  |                                                                                                
  |=================================================================================         |  90%
  |                                                                                                
  |==================================================================================        |  91%
  |                                                                                                
  |==================================================================================        |  92%
  |                                                                                                
  |===================================================================================       |  92%
  |                                                                                                
  |===================================================================================       |  93%
  |                                                                                                
  |====================================================================================      |  93%
  |                                                                                                
  |====================================================================================      |  94%
  |                                                                                                
  |=====================================================================================     |  94%
  |                                                                                                
  |=====================================================================================     |  95%
  |                                                                                                
  |======================================================================================    |  95%
  |                                                                                                
  |======================================================================================    |  96%
  |                                                                                                
  |=======================================================================================   |  96%
  |                                                                                                
  |=======================================================================================   |  97%
  |                                                                                                
  |========================================================================================  |  97%
  |                                                                                                
  |========================================================================================  |  98%
  |                                                                                                
  |========================================================================================= |  99%
  |                                                                                                
  |==========================================================================================| 100%
## [1] &quot;Sampled on average 210.5 points from 404 areas&quot;
## [1] &quot;Creating prediction semivariance matrix. This can take some time.&quot;
## [1] &quot;interpolating  404 areas&quot;
## 
  |                                                                                                
  |                                                                                          |   0%
  |                                                                                                
  |=                                                                                         |   1%
  |                                                                                                
  |==                                                                                        |   2%
  |                                                                                                
  |==                                                                                        |   3%
  |                                                                                                
  |===                                                                                       |   3%
  |                                                                                                
  |===                                                                                       |   4%
  |                                                                                                
  |====                                                                                      |   4%
  |                                                                                                
  |====                                                                                      |   5%
  |                                                                                                
  |=====                                                                                     |   5%
  |                                                                                                
  |=====                                                                                     |   6%
  |                                                                                                
  |======                                                                                    |   6%
  |                                                                                                
  |======                                                                                    |   7%
  |                                                                                                
  |=======                                                                                   |   7%
  |                                                                                                
  |=======                                                                                   |   8%
  |                                                                                                
  |========                                                                                  |   8%
  |                                                                                                
  |========                                                                                  |   9%
  |                                                                                                
  |=========                                                                                 |  10%
  |                                                                                                
  |==========                                                                                |  11%
  |                                                                                                
  |==========                                                                                |  12%
  |                                                                                                
  |===========                                                                               |  12%
  |                                                                                                
  |===========                                                                               |  13%
  |                                                                                                
  |============                                                                              |  13%
  |                                                                                                
  |============                                                                              |  14%
  |                                                                                                
  |=============                                                                             |  14%
  |                                                                                                
  |=============                                                                             |  15%
  |                                                                                                
  |==============                                                                            |  15%
  |                                                                                                
  |==============                                                                            |  16%
  |                                                                                                
  |===============                                                                           |  16%
  |                                                                                                
  |===============                                                                           |  17%
  |                                                                                                
  |================                                                                          |  17%
  |                                                                                                
  |================                                                                          |  18%
  |                                                                                                
  |=================                                                                         |  18%
  |                                                                                                
  |=================                                                                         |  19%
  |                                                                                                
  |==================                                                                        |  20%
  |                                                                                                
  |===================                                                                       |  21%
  |                                                                                                
  |===================                                                                       |  22%
  |                                                                                                
  |====================                                                                      |  22%
  |                                                                                                
  |====================                                                                      |  23%
  |                                                                                                
  |=====================                                                                     |  23%
  |                                                                                                
  |=====================                                                                     |  24%
  |                                                                                                
  |======================                                                                    |  24%
  |                                                                                                
  |======================                                                                    |  25%
  |                                                                                                
  |=======================                                                                   |  25%
  |                                                                                                
  |=======================                                                                   |  26%
  |                                                                                                
  |========================                                                                  |  26%
  |                                                                                                
  |========================                                                                  |  27%
  |                                                                                                
  |=========================                                                                 |  27%
  |                                                                                                
  |=========================                                                                 |  28%
  |                                                                                                
  |==========================                                                                |  29%
  |                                                                                                
  |===========================                                                               |  30%
  |                                                                                                
  |===========================                                                               |  31%
  |                                                                                                
  |============================                                                              |  31%
  |                                                                                                
  |============================                                                              |  32%
  |                                                                                                
  |=============================                                                             |  32%
  |                                                                                                
  |=============================                                                             |  33%
  |                                                                                                
  |==============================                                                            |  33%
  |                                                                                                
  |==============================                                                            |  34%
  |                                                                                                
  |===============================                                                           |  34%
  |                                                                                                
  |===============================                                                           |  35%
  |                                                                                                
  |================================                                                          |  35%
  |                                                                                                
  |================================                                                          |  36%
  |                                                                                                
  |=================================                                                         |  36%
  |                                                                                                
  |=================================                                                         |  37%
  |                                                                                                
  |==================================                                                        |  37%
  |                                                                                                
  |==================================                                                        |  38%
  |                                                                                                
  |===================================                                                       |  38%
  |                                                                                                
  |===================================                                                       |  39%
  |                                                                                                
  |====================================                                                      |  39%
  |                                                                                                
  |====================================                                                      |  40%
  |                                                                                                
  |=====================================                                                     |  41%
  |                                                                                                
  |======================================                                                    |  42%
  |                                                                                                
  |======================================                                                    |  43%
  |                                                                                                
  |=======================================                                                   |  43%
  |                                                                                                
  |=======================================                                                   |  44%
  |                                                                                                
  |========================================                                                  |  44%
  |                                                                                                
  |========================================                                                  |  45%
  |                                                                                                
  |=========================================                                                 |  45%
  |                                                                                                
  |=========================================                                                 |  46%
  |                                                                                                
  |==========================================                                                |  46%
  |                                                                                                
  |==========================================                                                |  47%
  |                                                                                                
  |===========================================                                               |  47%
  |                                                                                                
  |===========================================                                               |  48%
  |                                                                                                
  |============================================                                              |  48%
  |                                                                                                
  |============================================                                              |  49%
  |                                                                                                
  |=============================================                                             |  50%
  |                                                                                                
  |==============================================                                            |  51%
  |                                                                                                
  |==============================================                                            |  52%
  |                                                                                                
  |===============================================                                           |  52%
  |                                                                                                
  |===============================================                                           |  53%
  |                                                                                                
  |================================================                                          |  53%
  |                                                                                                
  |================================================                                          |  54%
  |                                                                                                
  |=================================================                                         |  54%
  |                                                                                                
  |=================================================                                         |  55%
  |                                                                                                
  |==================================================                                        |  55%
  |                                                                                                
  |==================================================                                        |  56%
  |                                                                                                
  |===================================================                                       |  56%
  |                                                                                                
  |===================================================                                       |  57%
  |                                                                                                
  |====================================================                                      |  57%
  |                                                                                                
  |====================================================                                      |  58%
  |                                                                                                
  |=====================================================                                     |  59%
  |                                                                                                
  |======================================================                                    |  60%
  |                                                                                                
  |======================================================                                    |  61%
  |                                                                                                
  |=======================================================                                   |  61%
  |                                                                                                
  |=======================================================                                   |  62%
  |                                                                                                
  |========================================================                                  |  62%
  |                                                                                                
  |========================================================                                  |  63%
  |                                                                                                
  |=========================================================                                 |  63%
  |                                                                                                
  |=========================================================                                 |  64%
  |                                                                                                
  |==========================================================                                |  64%
  |                                                                                                
  |==========================================================                                |  65%
  |                                                                                                
  |===========================================================                               |  65%
  |                                                                                                
  |===========================================================                               |  66%
  |                                                                                                
  |============================================================                              |  66%
  |                                                                                                
  |============================================================                              |  67%
  |                                                                                                
  |=============================================================                             |  67%
  |                                                                                                
  |=============================================================                             |  68%
  |                                                                                                
  |==============================================================                            |  68%
  |                                                                                                
  |==============================================================                            |  69%
  |                                                                                                
  |===============================================================                           |  69%
  |                                                                                                
  |===============================================================                           |  70%
  |                                                                                                
  |================================================================                          |  71%
  |                                                                                                
  |=================================================================                         |  72%
  |                                                                                                
  |=================================================================                         |  73%
  |                                                                                                
  |==================================================================                        |  73%
  |                                                                                                
  |==================================================================                        |  74%
  |                                                                                                
  |===================================================================                       |  74%
  |                                                                                                
  |===================================================================                       |  75%
  |                                                                                                
  |====================================================================                      |  75%
  |                                                                                                
  |====================================================================                      |  76%
  |                                                                                                
  |=====================================================================                     |  76%
  |                                                                                                
  |=====================================================================                     |  77%
  |                                                                                                
  |======================================================================                    |  77%
  |                                                                                                
  |======================================================================                    |  78%
  |                                                                                                
  |=======================================================================                   |  78%
  |                                                                                                
  |=======================================================================                   |  79%
  |                                                                                                
  |========================================================================                  |  80%
  |                                                                                                
  |=========================================================================                 |  81%
  |                                                                                                
  |=========================================================================                 |  82%
  |                                                                                                
  |==========================================================================                |  82%
  |                                                                                                
  |==========================================================================                |  83%
  |                                                                                                
  |===========================================================================               |  83%
  |                                                                                                
  |===========================================================================               |  84%
  |                                                                                                
  |============================================================================              |  84%
  |                                                                                                
  |============================================================================              |  85%
  |                                                                                                
  |=============================================================================             |  85%
  |                                                                                                
  |=============================================================================             |  86%
  |                                                                                                
  |==============================================================================            |  86%
  |                                                                                                
  |==============================================================================            |  87%
  |                                                                                                
  |===============================================================================           |  87%
  |                                                                                                
  |===============================================================================           |  88%
  |                                                                                                
  |================================================================================          |  88%
  |                                                                                                
  |================================================================================          |  89%
  |                                                                                                
  |=================================================================================         |  90%
  |                                                                                                
  |==================================================================================        |  91%
  |                                                                                                
  |==================================================================================        |  92%
  |                                                                                                
  |===================================================================================       |  92%
  |                                                                                                
  |===================================================================================       |  93%
  |                                                                                                
  |====================================================================================      |  93%
  |                                                                                                
  |====================================================================================      |  94%
  |                                                                                                
  |=====================================================================================     |  94%
  |                                                                                                
  |=====================================================================================     |  95%
  |                                                                                                
  |======================================================================================    |  95%
  |                                                                                                
  |======================================================================================    |  96%
  |                                                                                                
  |=======================================================================================   |  96%
  |                                                                                                
  |=======================================================================================   |  97%
  |                                                                                                
  |========================================================================================  |  97%
  |                                                                                                
  |========================================================================================  |  98%
  |                                                                                                
  |========================================================================================= |  99%
  |                                                                                                
  |==========================================================================================| 100%</code></pre>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="chapter-8.html#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(rtopObj<span class="sc">$</span>predictions)</span></code></pre></div>
<pre><code>##  [1] &quot;EZGID&quot;      &quot;HZBNR&quot;      &quot;SHAPE_AREA&quot; &quot;AREASQKM&quot;   &quot;Q95&quot;        &quot;Q95S&quot;       &quot;obs&quot;       
##  [8] &quot;area&quot;       &quot;var1.pred&quot;  &quot;var1.var&quot;   &quot;sumWeights&quot;</code></pre>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="chapter-8.html#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="fu">spplot</span>(<span class="at">obj=</span>rtopObj<span class="sc">$</span>predictions, <span class="at">zcol=</span><span class="fu">c</span>(<span class="st">&quot;obs&quot;</span>, <span class="st">&quot;var1.pred&quot;</span>,<span class="st">&quot;var1.var&quot;</span>),</span>
<span id="cb238-2"><a href="chapter-8.html#cb238-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">names.attr=</span><span class="fu">c</span>(<span class="st">&quot;obs&quot;</span>, <span class="st">&quot;pred&quot;</span>, <span class="st">&quot;var&quot;</span>),</span>
<span id="cb238-3"><a href="chapter-8.html#cb238-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">col.regions =</span> <span class="fu">rev</span>(<span class="fu">heat.colors</span>(<span class="at">n=</span><span class="dv">100</span>)), <span class="at">col=</span><span class="st">&quot;grey&quot;</span>,</span>
<span id="cb238-4"><a href="chapter-8.html#cb238-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">main=</span><span class="st">&quot;Prediction: sqrt(q95)&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-182-1.png" width="672" /></p>
<p>We can see that Top-kriging yields topologically consistent low flow predictions for the entire river network. Note that the maps display transformed low flow values. The predicted patterns of small (sub-)catchment (pred) appear fully consistent with the observation map (obs). The kriging variance map (var) shows that the predictions are most accurate in data-rich areas and least accurate in data-poor areas.</p>
</div>
<div id="cross-validation" class="section level3" number="4.2.6">
<h3><span class="header-section-number">4.2.6</span> Cross-validation</h3>
<p>Cross-validation can be called from <code>rtopKrige</code> if the argument <code>cv=TRUE</code> is set. The results allow us to assess how well the model performs in the prediction case.</p>
<p>In our first assessment we produce synoptic maps of observations and cv-predictions (together with the cv-kriging variance). We can see that the cross-validation corresponds well with observations and shows an equal performance over the study area.</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="chapter-8.html#cb239-1" aria-hidden="true" tabindex="-1"></a>rtopObj.cv <span class="ot">&lt;-</span> <span class="fu">rtopKrige</span>(rtopObj, <span class="at">cv =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] &quot;cross-validating 30 areas&quot;
## 
  |                                                                                                
  |                                                                                          |   0%
  |                                                                                                
  |===                                                                                       |   3%
  |                                                                                                
  |======                                                                                    |   7%
  |                                                                                                
  |=========                                                                                 |  10%
  |                                                                                                
  |============                                                                              |  14%
  |                                                                                                
  |================                                                                          |  17%
  |                                                                                                
  |===================                                                                       |  21%
  |                                                                                                
  |======================                                                                    |  24%
  |                                                                                                
  |=========================                                                                 |  28%
  |                                                                                                
  |============================                                                              |  31%
  |                                                                                                
  |===============================                                                           |  34%
  |                                                                                                
  |==================================                                                        |  38%
  |                                                                                                
  |=====================================                                                     |  41%
  |                                                                                                
  |========================================                                                  |  45%
  |                                                                                                
  |===========================================                                               |  48%
  |                                                                                                
  |===============================================                                           |  52%
  |                                                                                                
  |==================================================                                        |  55%
  |                                                                                                
  |=====================================================                                     |  59%
  |                                                                                                
  |========================================================                                  |  62%
  |                                                                                                
  |===========================================================                               |  66%
  |                                                                                                
  |==============================================================                            |  69%
  |                                                                                                
  |=================================================================                         |  72%
  |                                                                                                
  |====================================================================                      |  76%
  |                                                                                                
  |=======================================================================                   |  79%
  |                                                                                                
  |==========================================================================                |  83%
  |                                                                                                
  |==============================================================================            |  86%
  |                                                                                                
  |=================================================================================         |  90%
  |                                                                                                
  |====================================================================================      |  93%
  |                                                                                                
  |=======================================================================================   |  97%
  |                                                                                                
  |==========================================================================================| 100%</code></pre>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="chapter-8.html#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(rtopObj.cv<span class="sc">$</span>predictions)</span></code></pre></div>
<pre><code>##  [1] &quot;EZGID&quot;      &quot;HZBNR&quot;      &quot;SHAPE_AREA&quot; &quot;AREASQKM&quot;   &quot;Q95&quot;        &quot;Q95S&quot;       &quot;obs&quot;       
##  [8] &quot;area&quot;       &quot;var1.pred&quot;  &quot;var1.var&quot;   &quot;sumWeights&quot; &quot;observed&quot;   &quot;residual&quot;   &quot;zscore&quot;</code></pre>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="chapter-8.html#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="fu">spplot</span>(<span class="at">obj=</span>rtopObj.cv<span class="sc">$</span>predictions, <span class="at">zcol=</span><span class="fu">c</span>(<span class="st">&quot;obs&quot;</span>, <span class="st">&quot;var1.pred&quot;</span>,<span class="st">&quot;var1.var&quot;</span>),</span>
<span id="cb243-2"><a href="chapter-8.html#cb243-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">names.attr=</span><span class="fu">c</span>(<span class="st">&quot;obs&quot;</span>, <span class="st">&quot;pred&quot;</span>, <span class="st">&quot;var&quot;</span>),</span>
<span id="cb243-3"><a href="chapter-8.html#cb243-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">col.regions =</span> <span class="fu">rev</span>(<span class="fu">heat.colors</span>(<span class="at">n=</span><span class="dv">100</span>)), <span class="at">col=</span><span class="st">&quot;grey&quot;</span>,</span>
<span id="cb243-4"><a href="chapter-8.html#cb243-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">main=</span><span class="st">&quot;Cross-validation: sqrt(q95)&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-183-1.png" width="672" /></p>
<p>In our second assessment we produce some residual plots that are useful for investigating the predictive performance of our model in more detail. The first two plots in the upper panel show the distribution of residual (predicted - observed) values as a histogram and in a scatter-plot. We can see that the errors are symmetrically distributed around zero. The scatterplot shows a good agreement of predicted and observed values. Some underestimation of low values and overestimation of high values is visible, which is a typical effect of the simplification associated with modeling.</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="chapter-8.html#cb244-1" aria-hidden="true" tabindex="-1"></a>cv <span class="ot">&lt;-</span> rtopObj.cv<span class="sc">$</span>predictions</span>
<span id="cb244-2"><a href="chapter-8.html#cb244-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-3"><a href="chapter-8.html#cb244-3" aria-hidden="true" tabindex="-1"></a>def.par <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="at">no.readonly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb244-4"><a href="chapter-8.html#cb244-4" aria-hidden="true" tabindex="-1"></a><span class="fu">layout</span>(<span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>, <span class="dv">1</span>,<span class="dv">2</span>, <span class="dv">1</span>,<span class="dv">2</span>, <span class="dv">3</span>,<span class="dv">3</span>, <span class="dv">3</span>,<span class="dv">3</span>, <span class="dv">4</span>,<span class="dv">4</span>, <span class="dv">4</span>,<span class="dv">4</span>), <span class="dv">7</span>, <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>))</span>
<span id="cb244-5"><a href="chapter-8.html#cb244-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-6"><a href="chapter-8.html#cb244-6" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">pty=</span><span class="st">&quot;s&quot;</span>, <span class="at">mar=</span><span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">4</span>,<span class="dv">2</span>,<span class="dv">2</span>)<span class="sc">+</span><span class="fl">0.1</span>)</span>
<span id="cb244-7"><a href="chapter-8.html#cb244-7" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(cv<span class="sc">$</span>var1.pred<span class="sc">-</span>cv<span class="sc">$</span>obs, <span class="at">xlab=</span><span class="st">&quot;Predicted - observed&quot;</span>, <span class="at">main=</span><span class="cn">NULL</span>)</span>
<span id="cb244-8"><a href="chapter-8.html#cb244-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-9"><a href="chapter-8.html#cb244-9" aria-hidden="true" tabindex="-1"></a>xylim <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">min</span>(cv<span class="sc">$</span>obs, cv<span class="sc">$</span>var1.pred), <span class="fu">max</span>(cv<span class="sc">$</span>obs, cv<span class="sc">$</span>var1.pred))</span>
<span id="cb244-10"><a href="chapter-8.html#cb244-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x=</span>cv<span class="sc">$</span>obs, <span class="at">y=</span>cv<span class="sc">$</span>var1.pred, <span class="at">xlab=</span><span class="st">&quot;Observed&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;Predicted&quot;</span>, <span class="at">xlim=</span>xylim, <span class="at">ylim=</span>xylim)</span>
<span id="cb244-11"><a href="chapter-8.html#cb244-11" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span><span class="dv">0</span>, <span class="at">b=</span><span class="dv">1</span>)</span>
<span id="cb244-12"><a href="chapter-8.html#cb244-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-13"><a href="chapter-8.html#cb244-13" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">pty=</span><span class="st">&quot;m&quot;</span>)</span>
<span id="cb244-14"><a href="chapter-8.html#cb244-14" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x=</span>cv<span class="sc">$</span>var1.pred, <span class="at">y=</span>cv<span class="sc">$</span>var1.pred<span class="sc">-</span>cv<span class="sc">$</span>obs, <span class="at">xlab=</span><span class="st">&quot;Predicted&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;Pred - obs&quot;</span>)</span>
<span id="cb244-15"><a href="chapter-8.html#cb244-15" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>, <span class="at">lty=</span><span class="st">&quot;dotted&quot;</span>)</span>
<span id="cb244-16"><a href="chapter-8.html#cb244-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-17"><a href="chapter-8.html#cb244-17" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x=</span>cv<span class="sc">$</span>obs, <span class="at">y=</span>cv<span class="sc">$</span>var1.pred<span class="sc">-</span>cv<span class="sc">$</span>obs, <span class="at">xlab=</span><span class="st">&quot;Observed&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;Pred - obs&quot;</span>)</span>
<span id="cb244-18"><a href="chapter-8.html#cb244-18" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>, <span class="at">lty=</span><span class="st">&quot;dotted&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-184-1.png" width="672" /></p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="chapter-8.html#cb245-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(def.par)</span></code></pre></div>
<p>The remaining two plots show the prediction errors against predicted values (center panel) and against observed values (lower panel). The latter presents the residuals visible from the scatter plot in an alternative way, reflecting a high performance of the model apart from extreme observations. The scatter plot of residuals against predictions shows that the model exhibits a homogeneous prediction error and predictions are thus equally reliable for the range of predicted values.</p>
<p>We finally calculate cv-performance measures that are commonly used to summarize model performance. The first assessment is based on the transformed values. The model has a low RMSE (compared to the average low flow <span class="math inline">\(sqrt(q_{95})\)</span>), practically no bias, and a high coefficient of determination. The second assessment shows that the high performance is maintained after the back-transformation of the predictions to <span class="math inline">\(q_{95}\)</span>, a necessary step to obtain final results. From all assessments, the model appears well suited to perform low flow predictions in the study area.</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="chapter-8.html#cb246-1" aria-hidden="true" tabindex="-1"></a>cv_summary <span class="ot">&lt;-</span> <span class="cf">function</span> (pred, obs) {</span>
<span id="cb246-2"><a href="chapter-8.html#cb246-2" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> pred <span class="sc">-</span> obs</span>
<span id="cb246-3"><a href="chapter-8.html#cb246-3" aria-hidden="true" tabindex="-1"></a>ss <span class="ot">&lt;-</span> <span class="fu">sum</span>(res<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb246-4"><a href="chapter-8.html#cb246-4" aria-hidden="true" tabindex="-1"></a>mse <span class="ot">&lt;-</span> ss<span class="sc">/</span><span class="fu">length</span>(res)</span>
<span id="cb246-5"><a href="chapter-8.html#cb246-5" aria-hidden="true" tabindex="-1"></a>rmse <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(mse)</span>
<span id="cb246-6"><a href="chapter-8.html#cb246-6" aria-hidden="true" tabindex="-1"></a>R2 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">-</span>(mse<span class="sc">/</span><span class="fu">var</span>(obs))</span>
<span id="cb246-7"><a href="chapter-8.html#cb246-7" aria-hidden="true" tabindex="-1"></a>bias <span class="ot">&lt;-</span> <span class="fu">mean</span>(res)</span>
<span id="cb246-8"><a href="chapter-8.html#cb246-8" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span>(<span class="fu">list</span>(<span class="st">&quot;RMSE&quot;</span><span class="ot">=</span>rmse, <span class="st">&quot;BIAS&quot;</span><span class="ot">=</span>bias, <span class="st">&quot;R²&quot;</span><span class="ot">=</span>R2))</span>
<span id="cb246-9"><a href="chapter-8.html#cb246-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>CV-performance of (transformed) <span class="math inline">\(sqrt(q_{95})\)</span></p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="chapter-8.html#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cv_summary</span>(<span class="at">pred=</span>rtopObj.cv<span class="sc">$</span>predictions<span class="sc">$</span>var1.pred, <span class="at">obs=</span>rtopObj.cv<span class="sc">$</span>predictions<span class="sc">$</span>obs)</span></code></pre></div>
<pre><code>## $RMSE
## [1] 0.2309044
## 
## $BIAS
## [1] 0.02488073
## 
## $`R²`
## [1] 0.7341546</code></pre>
<p>CV-performance of retransformed <span class="math inline">\(q_{95}\)</span></p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="chapter-8.html#cb249-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cv_summary</span>(<span class="at">pred=</span>rtopObj.cv<span class="sc">$</span>predictions<span class="sc">$</span>var1.pred<span class="sc">^</span><span class="dv">2</span>, <span class="at">obs=</span>rtopObj.cv<span class="sc">$</span>predictions<span class="sc">$</span>obs<span class="sc">^</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>## $RMSE
## [1] 0.5948205
## 
## $BIAS
## [1] -0.035458
## 
## $`R²`
## [1] 0.7236259</code></pre>
</div>
<div id="references-1" class="section level3" number="4.2.7">
<h3><span class="header-section-number">4.2.7</span> References</h3>
<p>Laaha, G., Skøien, J.O., Nobilis, F. &amp; Blöschl, G. (2013) Spatial Prediction of Stream Temperatures Using Top-Kriging with an External Drift. Environmental Modeling &amp; Assessment 18(6), 671-683. <a href="doi:10.1007/s10666-013-9373-3" class="uri">doi:10.1007/s10666-013-9373-3</a></p>
<p>Laaha, G., Skøien, J.O. &amp; Blöschl, G. (2014) Spatial prediction on river networks: comparison of top-kriging with regional regression. Hydrological Processes 28, 315–324. <a href="https://doi.org/10.1002/hyp.9578" class="uri">https://doi.org/10.1002/hyp.9578</a></p>
<p>Skøien, J.O., Merz, R. &amp; Blöschl, G. (2006). Top-kriging - geostatistics on stream networks. Hydrology and Earth System Sciences, 10, 277-287. <a href="https://doi.org/10.5194/hess-10-277-2006" class="uri">https://doi.org/10.5194/hess-10-277-2006</a></p>
<p>Skøien, J.O., Blöschl, G., Laaha, G., Pebesma, E., Parajka, J. &amp; Viglione, A. (2014). Rtop: An R package for interpolation of data with a variable spatial support, with an example from river networks. Computers &amp; Geosciences, 67, 180–190. <a href="https://doi.org/10.1016/j.cageo.2014.02.009" class="uri">https://doi.org/10.1016/j.cageo.2014.02.009</a></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="chapter-7.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="chapter-10.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
