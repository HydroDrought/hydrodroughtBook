<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Worked example 6.2" />


<title>Drought deficit frequency analysis</title>

<link href="site_libs/tufte-css-2015.12.29/tufte-fonts.css" rel="stylesheet" />
<link href="site_libs/tufte-css-2015.12.29/tufte.css" rel="stylesheet" />
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>




<link rel="stylesheet" href="style.css" type="text/css" />




</head>

<body>




<h1 class="title toc-ignore">Drought deficit frequency analysis</h1>
<h4 class="author">Worked example 6.2</h4>


<div id="TOC">
<ul>
<li><a href="#data"><span class="toc-section-number">1</span> Data</a></li>
<li><a href="#derivation-of-distribution-function"><span class="toc-section-number">2</span> Derivation of distribution function</a></li>
<li><a href="#calculation-of-the-t-year-event"><span class="toc-section-number">3</span> Calculation of the T-year event</a></li>
<li><a href="#what-about-this-approach"><span class="toc-section-number">4</span> What about this approach</a><ul>
<li><a href="#partial-duration-series"><span class="toc-section-number">4.1</span> Partial duration series</a></li>
<li><a href="#annual-maxima-series"><span class="toc-section-number">4.2</span> Annual maxima series</a></li>
<li><a href="#fitting"><span class="toc-section-number">4.3</span> Fitting</a></li>
</ul></li>
</ul>
</div>

<p>River Ngaruroro at Kuripapango in New Zealand, applied for frequency analysis of annual minimum series in Worked Example 6.1, is here applied for frequency analysis of drought deficit characteristics. The drought events were derived using the Nizowka program (Software, CD) as described in Worked Example 5.4 (Section 5.4.1). Partial duration series (PDS) of drought events below a given threshold were selected from time series of daily discharge, and <span class="math inline">\(Q_{90}\)</span> was selected as the threshold. Two drought characteristics are analysed in the following: drought deficit volume and real drought duration as defined in Worked Example 5.4.</p>
<div id="data" class="section level1">
<h1><span class="header-section-number">1</span> Data</h1>
<pre class="r"><code>library(tidyverse)
library(hydroDrought)
library(lubridate)

ngaruroro &lt;- international %&gt;%
  filter(river == &quot;Ngaruroro&quot;) %&gt;%
  select(data) %&gt;%
  unnest(data) %&gt;%
  # fill gaps with a length of up to 15 days
  sanitize_ts(approx.missing = 15) %&gt;%
  mutate(
    year = water_year(time, origin = &quot;-09-01&quot;)
  ) </code></pre>
<pre class="r"><code># remove incomplete years
coverage &lt;- ngaruroro %&gt;%
  filter(!is.na(discharge)) %&gt;%
  pull(time) %&gt;%
  coverage_yearly(origin = &quot;-09-01&quot;)

incomplete &lt;- coverage %&gt;%
  filter(days.missing &gt; 0) %&gt;%
  print()</code></pre>
<pre><code>## # A tibble: 7 x 5
##    year days.in.year days.with.data days.missing coverage
##   &lt;dbl&gt;        &lt;int&gt;          &lt;int&gt;        &lt;int&gt;    &lt;dbl&gt;
## 1  1963          366            347           19    0.948
## 2  1965          365            294           71    0.805
## 3  1978          365            305           60    0.836
## 4  1986          365            341           24    0.934
## 5  1987          366            336           30    0.918
## 6  2001          365            344           21    0.942
## 7  2019          366             38          328    0.104</code></pre>
<pre class="r"><code>complete &lt;- coverage %&gt;%
  filter(days.missing == 0)

ngaruroro &lt;- ngaruroro %&gt;%
  anti_join(incomplete, by = &quot;year&quot;)</code></pre>
<p>Drought events were selected for River Ngaruroro and details of the selection criteria are given in Worked Example 5.4. The series cover the period 1964 to 2018 and the start of the year is set to 1 September.</p>
<p>A total of seven years were omitted from the series, 1963/64, 1965/66, 1978/79, 1986/87, 1987/88, 2001/02 and 2019/20, due to missing data.</p>
<pre class="r"><code>q90 &lt;- lfquantile(ngaruroro$discharge, exc.freq = 0.9) 

droughts &lt;- ngaruroro %&gt;%
  drought_events(
    threshold = q90, pooling = &quot;inter-event&quot;, 
    pooling.pars = list(min.duration = 2, min.vol.ratio = Inf), 
    full.table = TRUE
  ) %&gt;%
  mutate(
    year = water_year(first.day, origin = &quot;-09-01&quot;),
    year = factor(year, levels = full_seq(ngaruroro$year, 1))
  )

tbl &lt;- droughts %&gt;%
  transmute(
    event, year, first.day, last.day, 
    duration = as.double(duration, units = &quot;days&quot;),
    real.duration = dbt, 
    volume = volume / 1e3,
    rel.volume = volume / (17.30839 * 86.4),
    # rel.volume = as.difftime(round(rel.volume, 2), unit = &quot;days&quot;), 
    average.deficit = volume / duration
  ) %&gt;%
  print()</code></pre>
<pre><code>## # A tibble: 172 x 9
##    event year  first.day  last.day   duration real.duration  volume rel.volume
##    &lt;int&gt; &lt;fct&gt; &lt;date&gt;     &lt;date&gt;        &lt;dbl&gt; &lt;drtn&gt;          &lt;dbl&gt;      &lt;dbl&gt;
##  1     1 1966  1967-04-23 1967-04-23        1  1 days       3.54e+0   0.00237 
##  2     2 1966  1967-04-26 1967-04-26        1  1 days       1.81e+0   0.00121 
##  3     3 1966  1967-05-09 1967-05-10        2  2 days       1.19e+1   0.00797 
##  4     4 1966  1967-05-14 1967-05-14        1  1 days       1.39e+1   0.00930 
##  5     5 1966  1967-05-23 1967-05-23        1  1 days       2.59e-1   0.000173
##  6     6 1967  1968-02-07 1968-02-08        2  2 days       2.91e+1   0.0195  
##  7     7 1967  1968-02-18 1968-03-08       20 20 days       1.71e+3   1.14    
##  8     8 1967  1968-03-11 1968-04-02       23 23 days       2.29e+3   1.53    
##  9     9 1967  1968-04-06 1968-04-09        4  4 days       2.83e+2   0.189   
## 10    10 1968  1969-03-25 1969-04-03       10  9 days       1.72e+2   0.115   
## # … with 162 more rows, and 1 more variable: average.deficit &lt;dbl&gt;</code></pre>
<p>As only events below the <span class="math inline">\(Q_{90}\)</span> percentile are selected, it might happen that the flow never becomes less than the threshold in a year (non-drought year).</p>
<p>A total of twelve out of the 42 years with observations did not experience a drought (22.2%). The PDS series of drought deficit volume and real duration are plotted in Figure 6.12. Less severe values are found in the second half of the observation period for both deficit volume (upper) and duration (lower). The data are still treated as one sample as the number of observations is considered insufficient for a separate analysis of two periods. It should further be noted that a similar trend towards less severe droughts is not as pronounced for the <span class="math inline">\(AM(1)\)</span> values (Worked Example 6.1). This is likely a result of the high base flow contribution in the catchment (Figure 6.6).</p>
<div class="figure">
<p class="caption marginnote shownote">
Figure 6.12 PDS of drought deficit volume (upper) and real duration (lower) for River Ngaruroro at Kuripapango (NZ).
</p>
<img src="6-2_drought_deficit_frequency_sketch_files/figure-html/unnamed-chunk-7-1.png" alt="Figure 6.12 PDS of drought deficit volume (upper) and real duration (lower) for River
Ngaruroro at Kuripapango (NZ)." width="672"  />
</div>
</div>
<div id="derivation-of-distribution-function" class="section level1">
<h1><span class="header-section-number">2</span> Derivation of distribution function</h1>
<p>Following Zelenhasic &amp; Salvai (1987) an estimate of the non-exceedance probability, <span class="math inline">\(F(x)\)</span>, for the largest event in each time interval is in Nizowka obtained by combining the distribution for the occurrence of events and the distribution for the magnitudes of deficit volume or duration. Here a time interval of one year is chosen. Subsequently the return period in years for a given event can be calculated. The number of drought events occurring in a time period t is commonly assumed to be Poisson distributed (Equation 6.9) with parameter <span class="math inline">\(\lambda t\)</span>. In Nizowka the binomial Pascal distribution is offered along with the Poisson distribution as described in ‘Background Information NIZOWKA’ (Software, CD). The distribution that best fitted deficit volume was the Pascal distribution for the number of droughts and the GP distribution for the deficits. For duration the Pascal distribution was chosen along with the Log-Normal distribution. The <span class="math inline">\(F(x)\)</span> is for drought deficit volume plotted in Figure 6.13 together with the observed values plotted using a plotting position. The chosen distribution describes the data well, with the exception of some values in the upper range. The maximum value is, however, satisfactorily modelled.</p>
<p><img src="6-2_drought_deficit_frequency_sketch_files/figure-html/unnamed-chunk-9-1.png" width="672"  /></p>
</div>
<div id="calculation-of-the-t-year-event" class="section level1">
<h1><span class="header-section-number">3</span> Calculation of the T-year event</h1>
<p>The return period of a given event is calculated following Equation 6.4. The relationship between the drought characteristics as defined in Worked Example 5.4 and <span class="math inline">\(F(x)\)</span> are given by the tabulated distribution functions in Nizowka. The design value for a particular return period, i.e. the T-year event, can be obtained from the tables for known values of <span class="math inline">\(F(x)\)</span>. The estimated 10-, 100- and 200-year drought events are shown in Table 6.2.</p>
<pre><code>## # A tibble: 3 x 5
##    prob return.period real.duration rel.volume abs.volume
##   &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;
## 1 0.9             10.          24.7       1.29      1923.
## 2 0.99           100.          63.9       6.01      8992.
## 3 0.995          200.          79.7       9.05     13535.</code></pre>
</div>
<div id="what-about-this-approach" class="section level1">
<h1><span class="header-section-number">4</span> What about this approach</h1>
<div id="partial-duration-series" class="section level2">
<h2><span class="header-section-number">4.1</span> Partial duration series</h2>
<pre class="r"><code>threshold &lt;- 10
pds &lt;- tbl %&gt;%
  select(event, year, duration, first.day, last.day) %&gt;%
  filter(duration &gt; threshold) </code></pre>
</div>
<div id="annual-maxima-series" class="section level2">
<h2><span class="header-section-number">4.2</span> Annual maxima series</h2>
<pre class="r"><code>ams &lt;- tbl %&gt;%
  select(event, year, duration, first.day, last.day) %&gt;%
  group_by(year) %&gt;%
  slice_max(duration, with_ties = FALSE) %&gt;%
  ungroup() %&gt;%
  complete(year, fill = list(duration = 0))</code></pre>
</div>
<div id="fitting" class="section level2">
<h2><span class="header-section-number">4.3</span> Fitting</h2>
<pre class="r"><code>data &lt;- tibble(
  series = c(&quot;AMS&quot;, &quot;PDS&quot;, &quot;PDS-corrected&quot;),
  events.per.year = c(1, 1, nrow(pds) / nrow(ams)),
  bound = list(NULL, threshold, threshold),
  distribution = c(&quot;gum&quot;, &quot;gpa&quot;, &quot;gpa&quot;),
  observations = list(ams$duration, pds$duration, pds$duration)
) %&gt;%
  mutate(
    observations = map(observations, ~tibble(
      value = .x, 
      prob.emp = rank(value) / (length(value) + 1),
      rp.emp = (n() + 1) / rank(-value))
    ),
    fit = pmap(list(x = map(observations, &quot;value&quot;), 
                    dist = distribution, 
                    bound = bound,
                    correct.prob = events.per.year),
               fit_distr),
    fitted = map(fit, ~tibble(
      prob = seq(0.01, 1, 0.01),
      value = .x$qua(prob)
    )),
    quantiles = map(fit, ~tibble(
      rp = c(20, 50, 75, 100),
      prob = 1 - 1/rp,
      value = .x$qua(prob)
    ))
  )</code></pre>
<pre class="r"><code>obs &lt;- data %&gt;%
  select(series, observations) %&gt;%
  unnest(observations) 

fitted &lt;- data %&gt;%
  select(series, fitted) %&gt;%
  unnest(fitted) 

ggplot(fitted, aes(y = value, col = series)) + 
  geom_line(aes(x = prob)) + 
  geom_point(aes(x = prob.emp), data = obs)</code></pre>
<p><img src="6-2_drought_deficit_frequency_sketch_files/figure-html/unnamed-chunk-15-1.png" width="672"  /></p>
<pre class="r"><code>x &lt;- as.numeric(tbl$duration)
threshold &lt;- 1
rp &lt;- c(20, 50, 75, 100)
prob &lt;- 1 - 1/rp


library(extRemes)
fit &lt;- fevd(tbl$duration, threshold = threshold, type = &quot;GP&quot;, method = &quot;Lmoments&quot;,
          time.units = &quot;years&quot;, verbose = T)</code></pre>
<pre><code>## 
##  Data span  171 years 
## Beginning estimation procedure.</code></pre>
<pre class="r"><code># rate is the mean number of exceedances per year
rate &lt;- sum(x &gt; threshold) / nrow(complete)
fit$rate &lt;- rate

ci(fit, return.period = rp)</code></pre>
<pre><code>## fevd(x = tbl$duration, threshold = threshold, type = &quot;GP&quot;, method = &quot;Lmoments&quot;, 
##     time.units = &quot;years&quot;, verbose = T)
## 
## [1] &quot;Parametric Bootstrap&quot;
## 502  iterations
## 
##              2.5% Estimate     97.5%
## 20-year  40.90181 56.07492  76.60468
## 50-year  49.94378 74.10598 112.71594
## 75-year  53.99213 82.95371 132.23514
## 100-year 57.07501 89.58280 147.67782</code></pre>
<pre class="r"><code>library(lmom)
parameter &lt;- pelgpa(samlmu(x[x &gt; threshold]), bound = threshold)
prob.adj &lt;- 1 - (1 - prob)/rate
quagpa(prob.adj, parameter)</code></pre>
<pre><code>## [1] 56.07492 74.10598 82.95371 89.58280</code></pre>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
