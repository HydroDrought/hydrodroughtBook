<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Worked example 5.3" />


<title>Base Flow Index</title>

<link href="site_libs/tufte-css-2015.12.29/tufte-fonts.css" rel="stylesheet" />
<link href="site_libs/tufte-css-2015.12.29/tufte.css" rel="stylesheet" />
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>




<link rel="stylesheet" href="style.css" type="text/css" />




</head>

<body>




<h1 class="title toc-ignore">Base Flow Index</h1>
<h4 class="author">Worked example 5.3</h4>


<div id="TOC">
<ul>
<li><a href="#loading-the-data"><span class="toc-section-number">1</span> Loading the Data</a></li>
<li><a href="#calculation"><span class="toc-section-number">2</span> Calculation</a></li>
<li><a href="#results"><span class="toc-section-number">3</span> Results</a></li>
<li><a href="#fast-track"><span class="toc-section-number">4</span> Fast Track</a></li>
</ul>
</div>

<div id="loading-the-data" class="section level1">
<h1><span class="header-section-number">1</span> Loading the Data</h1>
<p>Three years of daily flow (1995 to 1997) from the Ray at Grendon Underwood (UK) have been selected. The base flow separation is done for the whole period, whereas the BFI is calculated for the mid-year 1996. This ensures that days at the start and end of the calculation year are included. In Table 5.7 the calculation steps are illustrated using data from the beginning of the record.</p>
<pre class="r"><code>library(tidyverse)
library(lubridate)
library(hydroDrought)

ray &lt;- international %&gt;%
  filter(river == &quot;Ray&quot;) %&gt;%
  select(data) %&gt;%
  unnest(data) %&gt;%
  mutate(
    year = water_year(time)
  ) %&gt;%
  filter(year &gt;= 1995, year &lt;= 1997)</code></pre>
</div>
<div id="calculation" class="section level1">
<h1><span class="header-section-number">2</span> Calculation</h1>
<ul>
<li>The daily flows, <span class="math inline">\(Q\)</span><i> </i>m<sup>3</sup>s<sup>-1</sup>, are divided into non-overlapping blocks of five days (Column 1 and 2).</li>
</ul>
<pre class="r"><code>ray &lt;- ray %&gt;%
  mutate(
    block = ((row_number() - 1) %/% 5) + 1
  ) %&gt;%
  print()</code></pre>
<pre><code>## # A tibble: 1,096 x 4
##    time       discharge  year block
##    &lt;date&gt;         &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 1995-01-01     0.109  1995     1
##  2 1995-01-02     0.063  1995     1
##  3 1995-01-03     0.043  1995     1
##  4 1995-01-04     0.039  1995     1
##  5 1995-01-05     0.229  1995     1
##  6 1995-01-06     0.186  1995     2
##  7 1995-01-07     0.116  1995     2
##  8 1995-01-08     0.111  1995     2
##  9 1995-01-09     0.095  1995     2
## 10 1995-01-10     0.123  1995     2
## # … with 1,086 more rows</code></pre>
<ul>
<li>Mark the minima of each of these blocks and let them be called <span class="math inline">\(Q_{min_1}\)</span>, <i>…</i> <span class="math inline">\(Q_{min_n}\)</span> (Column 3). Consider in turn (<span class="math inline">\(Q_{min_1}\)</span>, <span class="math inline">\(Q_{min_2}\)</span>, <span class="math inline">\(Q_{min_3}\)</span>), <i>…</i> (<span class="math inline">\(Q_{min_{n-1}}\)</span>, <span class="math inline">\(Q_{min_{n}}\)</span>, <span class="math inline">\(Q_{min_{n+1}}\)</span>). In each case, if 0.9<i>·</i>central value <i>≤</i> outer values, then the central value is a turning point for the base flow line (bold lines in Table 5.7). Continue this procedure until the whole time series has been analysed.</li>
</ul>
<pre class="r"><code>points &lt;- ray %&gt;%
  group_by(block) %&gt;%
  slice_min(discharge, with_ties = FALSE) %&gt;%
  ungroup() %&gt;%
  rename(Qmin = discharge) %&gt;%
  mutate(
    Qmin.red = 0.9 * Qmin,
    is.turning.point = Qmin.red &lt;= lag(Qmin) &amp; Qmin.red &lt;= lead(Qmin)
  )</code></pre>
<ul>
<li>Join the turning points by straight lines to form the base flow separation line and assign to each day a base flow value <span class="math inline">\(Q_b\)</span>, by linear interpolation between the turning points. If, on any day, the base flow estimated by this line exceeds the total flow, the base flow is set to be equal to the total flow <span class="math inline">\(Q\)</span>, on that day.</li>
</ul>
<pre class="r"><code>tp &lt;- points %&gt;%
  filter(is.turning.point) %&gt;%
  select(time, Qmin) %&gt;%
  print()</code></pre>
<pre><code>## # A tibble: 110 x 2
##    time        Qmin
##    &lt;date&gt;     &lt;dbl&gt;
##  1 1995-01-16 0.054
##  2 1995-02-07 0.1  
##  3 1995-02-19 0.188
##  4 1995-03-01 0.126
##  5 1995-03-26 0.022
##  6 1995-04-13 0.004
##  7 1995-04-21 0.003
##  8 1995-05-03 0.003
##  9 1995-05-06 0.003
## 10 1995-05-11 0.003
## # … with 100 more rows</code></pre>
<pre class="r"><code>baseflow &lt;- ray %&gt;%
  mutate(
    baseflow = approx(x = tp$time, y = tp$Qmin, xout = time)$y, 
    baseflow = pmin(baseflow, discharge)
  )</code></pre>
<ul>
<li><p>Calculate the volume of water (<span class="math inline">\(V_{base}\)</span>) beneath the base flow hydrograph between the first and last date of interest. The volume (m<sup>3</sup>) is simply derived as the sum of the daily base flow values multiplied by 86<i> </i>400 (the number of seconds per day).</p></li>
<li><p>Calculate the corresponding volume of water beneath the recorded hydrograph (<span class="math inline">\(V_{total}\)</span>). The volume (m<sup>3</sup>) is obtained by summing the daily flow values between the first and the last dates inclusive.</p></li>
</ul>
<pre class="r"><code>volume &lt;- baseflow %&gt;%
  filter(year == 1996) %&gt;%
  na.omit() %&gt;%
  summarise(
    total = sum(discharge) * 86400,
    baseflow = sum(baseflow) * 86400
  )</code></pre>
<ul>
<li>The BFI is then <span class="math inline">\(V_{base}/V_{total}\)</span>.</li>
</ul>
<pre class="r"><code>bfi &lt;- volume$baseflow / volume$total
bfi</code></pre>
<pre><code>## [1] 0.2024139</code></pre>
</div>
<div id="results" class="section level1">
<h1><span class="header-section-number">3</span> Results</h1>
<ul>
<li><p>The first and second turning points are found on day 1995-01-16 and day 1995-01-16 (Column 4), respectively, and a linear interpolation is used to estimate the base flow between these dates (Column 5). The daily base flow separation line is subsequently calculated for the whole period by linear interpolation between all turning points.</p></li>
<li><p>The volume beneath the base flow line, <span class="math inline">\(V_{base}\)</span>, for 1996 is found to be 348<i> </i>494.5<i> </i>m<sup>3</sup>, whereas the volume of the total flow, <span class="math inline">\(V_{total}\)</span>, is 1<i> </i>721<i> </i>693<i> </i>m<sup>3</sup>. The resultant BFI is 0.2. The base flow separation line for River Ray in 1996 is shown in Figure 5.4 of the book.</p></li>
</ul>
</div>
<div id="fast-track" class="section level1">
<h1><span class="header-section-number">4</span> Fast Track</h1>
<p>The base flow for a given time series can also be calculated directely using the function <code>baseflow()</code>, optionally with a different choice of the block length or the reduction factor for the central value. The default values are <code>tp.factor = 0.9</code> and <code>block.len = 5</code>.</p>
<pre class="r"><code>bf &lt;- ray %&gt;%
  select(time, discharge) %&gt;%
  mutate(
    baseflow = baseflow(discharge, tp.factor = 0.9, block.len = 5)
    ) %&gt;%
  filter(year(time) == 1996) %&gt;%
  print()</code></pre>
<pre><code>## # A tibble: 366 x 3
##    time       discharge baseflow
##    &lt;date&gt;         &lt;dbl&gt;    &lt;dbl&gt;
##  1 1996-01-01     0.19    0.0332
##  2 1996-01-02     0.224   0.0326
##  3 1996-01-03     0.189   0.0320
##  4 1996-01-04     0.145   0.0314
##  5 1996-01-05     0.221   0.0308
##  6 1996-01-06     0.385   0.0302
##  7 1996-01-07     0.567   0.0296
##  8 1996-01-08     0.463   0.0291
##  9 1996-01-09     1.38    0.0285
## 10 1996-01-10     0.475   0.0279
## # … with 356 more rows</code></pre>
<div class="figure">
<p class="caption marginnote shownote">
Figure 5.4 Annual recorded hydrograph and calculated continuous base flow line for UK river Ray in year 1996.
</p>
<img src="5-3_base_flow_index_files/figure-html/unnamed-chunk-9-1.png" alt="Figure 5.4 Annual recorded hydrograph and calculated continuous base flow line for UK river Ray in year 1996." width="672"  />
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
